create_ralis_country = { #target a valid planet with this
	create_species = {
		name = "Esear"
		plural = "Esears"
		class = AVI
		portrait = cyb5
		homeworld = root
		traits = random
		sapient = yes
		effect = {}
	}

	create_country = {
		name = "Sactuary of Ralis"
		adjective = "Rali"
		type = primitive
		# auto_delete = no
		name_list = AVI4
		# contact_rule = default
		ship_prefix = "SoR"
		authority = "auth_imperial"
		civics = { civic = civic_fanatic_purifiers civic = civic_heroic_tales }
		species = last_created_species
		flag = {
			icon = { category = "union_state" file = ralis_banner.dds }
			background = { category = "backgrounds" file = "00_solid.dds" }
			colors = {"purple" "dark_purple" "null" "null" }
		}
		ethos = { ethic = ethic_fanatic_xenophobe ethic = ethic_militarist }
		effect = {
			set_country_type = default
			save_global_event_target_as = f93_ralis_country
			give_technology = {
				tech = tech_archaeo_refinery
			}
			set_country_flag = ralis_country_flag
			add_resource = {
				alloys = 2
				minerals = 5
				energy = 6
				food = 0.01
				consumer_goods = 0.25
				unity = 0.1
				mult = 3000
			}
			add_modifier = {
				modifier = fe_ship_cost_modifier
				multiplier = 1
				days = -1
			}
		}
	}
	create_colony = {
		owner = last_created_country
		species = last_created_species
	}
	while = {
		count = 120
		create_pop = {
			species = last_created_species
			ethos = last_created_country
		}
	}
	event_target:f93_ralis_country = {
		capital_scope = {
			save_global_event_target_as = f93_ralis_planet
		}
	}
	remove_building = building_colony_shelter
	add_building = building_major_capital
	add_building = building_archaeo_refinery
	add_building = building_nourishment_complex
	add_building = building_nourishment_complex
	add_building = building_nourishment_complex
	add_deposit = d_arcane_generator

	while = {
		count = 3
		add_district = district_arcology_housing
		add_district = district_arcology_arms_industry
		add_district = district_arcology_civilian_industry
		add_district = district_arcology_leisure
		add_district = district_arcology_administrative
	}

	add_modifier = {
		modifier = ruler_savior
		multiplier = 100
		days = 7200
	}
	add_modifier = {
		modifier = b_world_saved
		multiplier = 1.5
		days = 7200
	}
	add_modifier = {
		modifier = cost_of_freedom_07
		multiplier = 100
		days = 7200
	}
	add_modifier = {
		modifier = wasteland_infrastructure
		multiplier = 4
		days = 7200
	}
	add_modifier = {
		modifier = wasteland_orbital_debris
		multiplier = -10
		days = 7200
	}
	add_modifier = {
		modifier = horse_powered_factories_medium
		multiplier = 10
		days = 7200
	}
	add_modifier = {
		modifier = black_hole_energy
		days = -1
	}
}

give_ciris_sphere_0_and_buff = {
	set_ai_personality = fanatic_purifiers
	add_resource = {
		sr_dark_matter = 1
		alloys = 2
		minerals = 0.5
		energy = 3
		food = 0.01
		consumer_goods = 0.25
		unity = 0.1
		mult = 30000
	}
	add_tradition = tr_supremacy_adopt
	add_tradition = tr_supremacy_fleet_logistical_corps
	add_tradition = tr_supremacy_master_shipwrights
	add_tradition = tr_supremacy_war_games
	add_tradition = tr_supremacy_overwhelming_force
	add_tradition = tr_supremacy_great_game
	add_tradition = tr_supremacy_finish
	give_technology = { tech = tech_wormhole_stabilization }
	add_ascension_perk = ap_become_the_crisis #only works on 4.0 and up

	random_system_within_border = {
		limit = { has_megastructure = crisis_sphere_ruined }
		random_system_megastructure = {
			limit = { is_megastructure_type = crisis_sphere_ruined }
			remove_megastructure = this
		}
		spawn_megastructure = {
			type = crisis_sphere_0
		}
		random_system_megastructure = {
			limit = { is_megastructure_type = crisis_sphere_0 }
			set_megastructure_flag = crisis_sphere
		}
		star = {
			create_ambient_object = {
				type = "crisis_sphere_1"
				location = this
			}
			last_created_ambient_object = {
				set_ambient_object_flag = crisis_sphere_1_system_effect
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		
		random_system = {
			limit = { NOT = { exists = owner } has_megastructure = dandelion_relay }
			prev = {
				spawn_natural_wormhole = {
					bypass_type = wormhole
					random_pos = yes
					orbit_angle = 360
				}
			}
			spawn_natural_wormhole = {
				bypass_type = wormhole
				random_pos = yes
				orbit_angle = 360
			}
			link_wormholes = prev
		}
	}
}

create_capital_to_acient_relay_lane = {
	if = {
		limit = {
			exists = event_target:system_capital
			exists = event_target:system_ancient_relay
		}
		save_global_event_target_as = system_last_step
		while = {
			# count = @steps
			limit = {
				NOT = { event_target:system_ancient_relay = { any_neighbor_system = { is_same_value = event_target:system_last_step } } } 
			}
			event_target:system_ancient_relay = {
				closest_system = {
					limit = {
						NOT = { has_star_flag = dd_highway_system_flag }
						or = {
							distance = {
								source = event_target:system_last_step
								max_jumps = 1
								type = hyperlane
							}
						}
					}
					save_global_event_target_as = new_highway_system
					root = { set_country_flag = f93_empire_connects_to_ancient_relay_flag }
				}
			}
			clear_global_event_target = new_highway_system

		}
		if = {
			limit = { event_target:system_ancient_relay = { any_neighbor_system = { is_same_value = event_target:system_last_step } } }
			set_country_flag = f93_empire_connects_to_ancient_relay_flag
		}
	}
}

f93_create_community_ralis_admin = {
	create_country = {
		name = f93_community_ralis_admin_NAME
		adjective = f93_community_ralis_admin_ADJ
		type = nice_faction
		auto_delete = no
		name_list = random
		ship_prefix = "GalCom"
		flag = {
			icon = { category = "union_state" file = cra_flag.dds }
			background = { category = "backgrounds" file = "00_solid.dds" }
			colors = {"blue" "dark_blue" "null" "null" }
		}
		effect = { save_global_event_target_as = f93_community_ralis_admin_country }
		# graphical_culture = root.owner
	}
}

#Ralis Decision
f93_return_ralis = {
	name = f93_ralis_crisis_event.0902.a # keep the plan
	every_playable_country = {
		add_opinion_modifier = { modifier = f93_liberator_of_ralis who = root }
	}
	hidden_effect = {
		set_country_flag = f93_handed_ralis_to_community
	}
	if = {
		limit = {
			is_galactic_community_member = yes
		}
		every_system_within_border = {
			limit = {
				OR = {
					has_star_flag = f93_belonged_to_ralis
					AND = {
						NOT = {
							has_star_flag = f93_ralis_took_it_from@root
						}
						has_star_flag = f93_ralis_took_it_from_someome
					}
				}
			}
			starbase = { set_owner = event_target:f93_community_ralis_admin }
		}
	else = {
		every_system_within_border = {
			limit = {
				has_star_flag = f93_belonged_to_ralis
			}
			starbase = { set_owner = event_target:f93_community_ralis_admin }
		}
	}
	}
}
f93_keep_ralis = {
	name = f93_ralis_crisis_event.0902.b #keep ralis
	country_event = { id = f93_ralis_crisis_event.1001}
	hidden_effect = {
		set_country_flag = f93_conquered_and_kept_ralis
	}
	event_target:f93_ralis_planet = {
		solar_system.starbase = {
			set_owner = event_target:f93_ralis_liberator
		}
	}
	
	if = {
		limit = {
			is_galactic_community_member = yes
			event_target:f93_ralis_planet = {
				has_planet_flag = f93_galactic_community_claim
			}
		}
		every_playable_country = {
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = root }
		}
		remove_from_galactic_community = yes
	}
}