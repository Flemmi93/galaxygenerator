namespace = f93_ralis_crisis_event

# Ralis Crisis 
#################################
# numbers						#
# first 2 digits are level		#
# 2nd two digits are varriance	#
#################################

#Anomalies along the Galactic Crossing
country_event = {
	id = f93_ralis_crisis_event.0001
	title = f93_ralis_crisis_event.0001.name
	desc = f93_ralis_crisis_event.0001.desc
	picture = GFX_evt_ongoing_disaster
	show_sound = event_whispering
	fire_only_once = yes
	
	mean_time_to_happen = 1

	trigger = {
		# is_ai = no
		mid_game_years_passed >= 0
	}

	immediate = {
		set_global_flag = f93_ralis_awoken
		every_playable_country = {
			country_event = {
				id = f93_ralis_crisis_event.0101
				days = 120
			}
		}
		every_playable_country = {
			limit = { NOR = { is_same_value = root has_country_flag = ralis_country_flag } }
			country_event = { id = f93_ralis_crisis_event.0002 }
		}
		event_target:f93_ralis_country = {
			set_ai_personality = fanatic_purifiers
			add_resource = {
				sr_dark_matter = 1
				alloys = 2
				minerals = 0.5
				energy = 3
				food = 0.01
				consumer_goods = 0.25
				unity = 0.1
				mult = 30000
			}
			add_tradition = tr_supremacy_adopt
			add_tradition = tr_supremacy_fleet_logistical_corps
			add_tradition = tr_supremacy_master_shipwrights
			add_tradition = tr_supremacy_war_games
			add_tradition = tr_supremacy_overwhelming_force
			add_tradition = tr_supremacy_great_game
			add_tradition = tr_supremacy_finish
			give_technology = { tech = tech_wormhole_stabilization } 
			add_ascension_perk = ap_become_the_crisis #only works on 4.0 and up
			force_remove_civic = 1
			force_remove_civic = 1
			force_add_civic = civic_fanatic_purifiers
			force_add_civic = civic_heroic_tales
			create_fleet = {
				name = "Explorer Fleet"
				effect = {
					set_owner = event_target:f93_ralis_country
					set_location = event_target:f93_ralis_country.capital_scope
					create_ship = {
						name = random
						random_existing_design = science
					}
				}
			}
			create_fleet = {
				name = "Explorer Fleet"
				effect = {
					set_owner = event_target:f93_ralis_country
					set_location = event_target:f93_ralis_country.capital_scope
					create_ship = {
						name = random
						random_existing_design = science
					}
				}
			}
			if = {
				limit = { NOT = { has_modifier = f93_ralis_country_buff } }
				add_modifier = {
					modifier = f93_ralis_country_buff
					multiplier = 1
					days = -1
				}
			}
			random_system_within_border = {
				limit = { has_megastructure = crisis_sphere_ruined }
				random_system_megastructure = {
					limit = { is_megastructure_type = crisis_sphere_ruined }
					remove_megastructure = this
				}
				random_system_megastructure = {
					limit = { is_megastructure_type = crisis_sphere_0 }
					set_megastructure_flag = crisis_sphere
				}
				star = {
					create_ambient_object = {
						type = "crisis_sphere_1"
						location = this
					}
					last_created_ambient_object = {
						set_ambient_object_flag = crisis_sphere_1_system_effect
						set_location = {
							target = prev
							distance = 0
							angle = random
						}
					}	
				}
				set_global_flag = f93_shroud_gate_active
				random_system = {
					limit = { NOT = { exists = owner } f93_system_has_ancient_relay = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
					prev = {
						f93_place_shroud_gate_node = yes
					}
					f93_place_shroud_gate_nexus = yes
				}
				random_system = {
					limit = { NOT = { exists = owner } f93_system_has_ancient_relay = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
					f93_place_shroud_gate_nexus = yes
				}
			}
		}
	}
	option = {
		name = WORRYING
	}
}
#Anomalies along the Galactic Crossing
country_event = {
	id = f93_ralis_crisis_event.0002
	title = f93_ralis_crisis_event.0001.name
	desc = f93_ralis_crisis_event.0001.desc
	picture = GFX_evt_ongoing_disaster
	show_sound = event_whispering
	is_triggered_only = yes
	option = {
		name = WORRYING
	}
}

#A galaxy holds its breath
country_event = {
	id = f93_ralis_crisis_event.0101
	title = f93_ralis_crisis_event.0101.name
	desc = f93_ralis_crisis_event.0101.desc
	picture = GFX_evt_supernova
	show_sound = event_screams
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event0101_happened } }
			set_global_flag = f93_ralis_crisis_event0101_happened
			every_system = {
				limit = {
					NOR = {
						has_star_flag = f93_ralis_crisis_event0101_already_flag
						f93_should_not_be_destroyed = yes
						any_system_planet = { is_colonizable = yes }
					}
					any_neighbor_system = { f93_system_has_ancient_relay = yes }
					NOT = {
						owner = { OR = { is_country_type = fallen_empire is_country_type = awakened_fallen_empire } }
						any_system_planet = { is_colonizable = yes }
					}
				}
				set_star_flag = f93_ralis_crisis_event0101_already_flag
				if = {
					limit = {
						f93_system_has_ancient_relay = yes
					}
					set_star_flag = f93_has_dandelion_relay
				}
				random_list = {
					50 = { destroy_star_system = yes every_system_planet = { reroll_deposits = yes } }
					50 = { }
				}
				if = {
					limit = { has_star_flag = f93_has_dandelion_relay f93_system_has_ancient_relay = no }
					highway_connect_relay_only = yes
				}
			}
			every_system = {
				limit = {
					NOR = {
						has_star_flag = f93_ralis_crisis_event0101_already_flag
						f93_should_not_be_destroyed = yes
						star = { is_star_class = sc_no_star }
					}
					any_system_planet = { is_colonizable = yes }
					is_capital_system = no
					any_neighbor_system = { f93_system_has_ancient_relay = yes }
				}
				set_star_flag = f93_ralis_crisis_event0101_already_flag
				if = {
					limit = {
						f93_system_has_ancient_relay = yes
					}
					set_star_flag = f93_has_dandelion_relay
				}
				random_list = {
					33 = { destroy_star_system = yes set_star_flag = f93_ralis_crisis_event_got_hit_flag every_system_planet = { reroll_deposits = yes } }
					67 = { }
				}
				if = {
					limit = { has_star_flag = f93_has_dandelion_relay f93_system_has_ancient_relay = no }
					highway_connect_relay_only = yes
				}
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.0101.a
		country_event = { id = f93_ralis_crisis_event.0201 days = 30 }
		hidden_effect = {
			random_country = {
				limit = {
					is_ai = yes
					is_country_type = default
					any_system_within_border = { has_star_flag = f93_ralis_crisis_event_got_hit_flag }
				}
				save_global_event_target_as = f93_to_be_killed_by_ralis
			}
			if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
						f93_is_close_to_highway = yes
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
		}
	}
}

#Senate Report
country_event = {
	id = f93_ralis_crisis_event.0201
	title = f93_ralis_crisis_event.0201.name
	desc = f93_ralis_crisis_event.0201.desc
	picture = GFX_evt_astral_rift_ancient_battlegrounds
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event0201_happened } }
			set_global_flag = f93_ralis_crisis_event0201_happened
			event_target:f93_to_be_killed_by_ralis = {
				every_system_within_border = {
					limit = { NOT = { f93_should_not_be_destroyed = yes } }
					destroy_star_system = yes every_system_planet = { reroll_deposits = yes }
				}
				destroy_country = yes
			}
			event_target:f93_ralis_country = {
				if = {
					limit = { is_ai = yes }
					add_resource = {
						menace = 10000
					}
					country_event = { id = f93_ralis_crisis_event.0202 days = 720 random = 360 }
				}
				capital_scope = { set_name = "Ralis" }
				every_playable_country = {
					establish_contact = { who = prev location = prev.capital_scope }
				}
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.0201.a
		country_event = { id = f93_ralis_crisis_event.0301 days = 180 }
	}
}

country_event = {
	id = f93_ralis_crisis_event.0202
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		random_system = {
			limit = { has_star_flag = f93_ralis_empire_cluster }
			spawn_megastructure = {
				type = think_tank_4
				owner = root
				planet = star
				graphical_culture = root
			}
			save_global_event_target_as = f93_ralis_think_tank_system
			add_hyperlane = { from = this to = event_target:f93_ralis_system }
		}
	}
}

#Receding of the Abyss
country_event = {
	id = f93_ralis_crisis_event.0301
	title = f93_ralis_crisis_event.0301.name
	desc = f93_ralis_crisis_event.0301.desc
	picture = GFX_evt_treasure_trove_pirate_fleet
	
	is_triggered_only = yes

	immediate = {
		event_target:f93_ralis_country = {
			establish_contact = { who = root }
			set_country_flag = f93_ralis_arms_race_active
		}
	}
	option = {
		name = f93_ralis_crisis_event.0301.a
	}
	option = {
		name = f93_ralis_crisis_event.0301.b
	}

	after = {

	}
}
country_event = {
	id = f93_ralis_crisis_event.0400
	hide_window = yes
	fire_only_once = yes
	mean_time_to_happen = 1
	trigger = {
		mid_game_years_passed >= 0
		exists = event_target:f93_ralis_country
		event_target:f93_ralis_country = {
			OR = {
				has_crisis_level = crisis_level_2
				has_crisis_level = crisis_level_3
				has_crisis_level = crisis_level_4
				has_crisis_level = crisis_level_5
			}
		}
	}
	immediate = {
		every_playable_country = {
			country_event = { id = f93_ralis_crisis_event.0401 days = 720 }
		}
	}
}
#Secrets of Ralis
country_event = {
	id = f93_ralis_crisis_event.0401
	title = f93_ralis_crisis_event.0401.name
	desc = f93_ralis_crisis_event.0401.desc
	picture = GFX_evt_cosmic_storms_the_storm_speaks
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	immediate = {}
	option = {
		name = f93_ralis_crisis_event.0401.a
		country_event = { id = f93_ralis_crisis_event.0501 days = 90 }
	}
	after = {}
}

#The War Plan Debate
country_event = {
	id = f93_ralis_crisis_event.0501
	title = f93_ralis_crisis_event.0501.name
	desc = f93_ralis_crisis_event.0501.desc
	picture = GFX_evt_civil_action
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	trigger = {
	}
	immediate = {
		event_target:f93_ralis_country = {
			add_modifier = {
				modifier = f93_ralis_science_stop
				multiplier = 1
			}
		}
		set_global_flag = f93_activate_ralis_resolution_1
	}
	option = {
		name = f93_ralis_crisis_event.0501.a
		custom_tooltip = f93_ralis_crisis_event.0501.a_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_a
		}
	}
	option = {
		name = f93_ralis_crisis_event.0501.b
		custom_tooltip = f93_ralis_crisis_event.0501.b_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_b
		}
	}
	after = {
	}
}


country_event = {
	id = f93_ralis_crisis_event.0601
	title = f93_ralis_crisis_event.0601.name
	desc = f93_ralis_crisis_event.0601.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		event_target:f93_ralis_country = {
			remove_modifier = f93_ralis_science_stop
		}
		every_playable_country = {
			limit = { NOT = { has_country_flag = ralis_country_flag } }
			every_system_within_border = {
				set_star_flag = f93_ralis_took_it_from@prev
			}
		}
	}
	option = {
		allow = {
			OR = {
				is_egalitarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophile = yes
				is_megacorp = yes
			}
		}
		name = f93_ralis_crisis_event.0601.a
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty
		}
	}
	option = {
		allow = {
			OR = {
				is_authoritarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophobe = yes
				is_gestalt = yes
			}
		}
		name = f93_ralis_crisis_event.0601.b
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty_unwillingly
		}
	}
	option = {
		trigger = { is_ai = yes }
		name = OK
	}
	option = {
		trigger = { is_ai = no }
		name = f93_ralis_crisis_event.0601.c
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_rejected_treaty
		}
		remove_from_galactic_community = yes
	}
	
}
#The War plan treaty failed
country_event = {
	id = f93_ralis_crisis_event.0602
	title = f93_ralis_crisis_event.0602.name
	desc = f93_ralis_crisis_event.0602.desc
	picture = GFX_evt_two_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		event_target:f93_ralis_country = {
			remove_modifier = f93_ralis_science_stop
		}
	}
	option = {
		name = f93_ralis_crisis_event.0602.a
	}
}
#The War plan treaty passed and tells everyone else about it
country_event = {
	id = f93_ralis_crisis_event.0603
	title = f93_ralis_crisis_event.0603.name
	desc = f93_ralis_crisis_event.0603.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = no
	}
	is_triggered_only = yes

	option = {
		name = OK
	}
}

#tracking what system was conquered from who by ralis

country_event = {
	id = f93_ralis_crisis_event.0606
	hide_window = yes
	mean_time_to_happen = 15
	
	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
		any_system = {
			exists = starbase
			starbase = { controller = { is_same_value = event_target:f93_ralis_country } }
			any_system_colony = {
				owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
			}
		}
	}
	immediate = {
		every_system = {
			limit = {
				exists = starbase
				starbase = { controller = { is_same_value = event_target:f93_ralis_country } }
				any_system_colony = { owner = { NOT = { is_same_value = event_target:f93_ralis_country } } }
			}
			every_system_colony = { set_owner = event_target:f93_ralis_country }
		}
	}
}

country_event = {
	id = f93_ralis_crisis_event.0604
	hide_window = yes
	mean_time_to_happen = 15
	
	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
		event_target:f93_ralis_system = {
			has_star_flag = crisis_sphere_system@prev
		}
	}

	immediate = {
		every_system_within_border = {
			limit = {
				NOR = {
					has_star_flag = f93_belonged_to_ralis
					has_star_flag = f93_ralis_took_it_from_someone
				}
			}
			set_star_flag = f93_ralis_took_it_from_someone
		}
	}
}

country_event = {
	id = f93_ralis_crisis_event.0605
	hide_window = yes
	mean_time_to_happen = 180
	fire_only_once = yes

	trigger = {
		exists = event_target:f93_ralis_country
		event_target:f93_ralis_country = {
			is_level_5_player_crisis = yes
		}
	}

	immediate = {
		event_target:f93_ralis_think_tank_system = {
			every_system_megastructure = {
				limit = { is_megastructure_type = think_tank_4 }
				remove_megastructure = this
			}
			spawn_megastructure = { type = think_tank_ruined }
		}
	}
}
#anyone entering ralis system for the first time
country_event = {
	id = f93_ralis_crisis_event.0701
	title = f93_ralis_crisis_event.0701.name
	desc = f93_ralis_crisis_event.0701.desc
	picture = GFX_evt_situation_the_seal
	# show_sound = event_mystic_reveal

	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.0701.a
	}
}

planet_event = {
	id = f93_ralis_crisis_event.0800
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_same_value = event_target:f93_ralis_planet
	}

	immediate = {
		if = {
			limit = {
				from = {
					is_country_type = default
					event_target:f93_ralis_planet = { is_colony = no }
				}
			}
			every_country = { country_event = { id = f93_ralis_crisis_event.0801 } }
		}
		if = {
			limit = {
				from = {
					is_country_type = default
					event_target:f93_ralis_planet = { is_colony = no }
				}
			}
			every_country = { country_event = { id = f93_ralis_crisis_event.0801 } }
		}
		else_if = {
			limit = { from = { is_ship_size = colossus } }
			every_country = { country_event = { id = f93_ralis_crisis_event.0801 } }
		}
	}
}
#ralis is destroyed
#nothing happens, the story ends here.
country_event = {
	id = f93_ralis_crisis_event.0801
	title = f93_ralis_crisis_event.0801.name
	desc = f93_ralis_crisis_event.0801.desc
	picture = GFX_evt_large_explosion
	# show_sound = event_mystic_reveal

	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.0801.a
	}
}

# This = Planet scope
# From = Country scope (new owner)
# FromFrom = Former Owner
#ralis is conquered
country_event = {
	id = f93_ralis_crisis_event.0802
	title = f93_ralis_crisis_event.0802.name
	desc = f93_ralis_crisis_event.0802.desc
	picture = GFX_evt_burning_city
	fire_only_once = yes
	trigger = {
		any_owned_planet = {
			exists = event_target:f93_ralis_planet
			is_same_value = event_target:f93_ralis_planet
			owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
		}
	}
	mean_time_to_happen = 1
	immediate = {
		save_global_event_target_as = f93_ralis_liberator
		event_target:f93_ralis_country = {
			set_name = "Remnants of Ralis"
		}
	}
	option = {
		name = f93_ralis_crisis_event.0802.a 
		hidden_effect = {
			#treaty paths
			if = {
				limit = {
					event_target:f93_ralis_planet = { has_planet_flag = f93_galactic_community_claim }
				}
				#The Community's Mandate
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0901 days = 360 }
				}
				#The Community's Claim
				if = {
					limit = {
						event_target:f93_ralis_liberator = {
							is_galactic_community_member = yes
						}
					}
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0902 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_community_liberator
						}
					}
				}
				#The Community’s Request
				else = {
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_independent_liberator
						}
					}
				}
			}
			#no treaty path
			else = {
				#The Community’s Request
				event_target:f93_ralis_liberator = {
					country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
				}
				#The Community’s Plea
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0905 days = 360 }
				}
			}
		}
	}
}

#Treaty Path
#The Community's Mandate, shown to all but the Ralis Liberator
country_event = {
	id = f93_ralis_crisis_event.0901
	title = f93_ralis_crisis_event.0901.name
	desc = f93_ralis_crisis_event.0901.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	#hand systems over to administration
	option = { 
		name = f93_ralis_crisis_event.0901.a
		trigger = { is_galactic_community_member = yes }
		f93_give_conquest_to_ralis_admin = yes
		every_playable_country = {
			limit = { is_galactic_community_member = yes }		
			add_opinion_modifier = { modifier = f93_kept_ralis_treaty who = root }
		}
		ai_chance = {
			factor = 50 # opposes the last option
		}
	}
	option = {
		trigger = { is_galactic_community_member = yes is_ai = no }
		name = f93_ralis_crisis_event.0901.d
		allow = { always = no }
	}
	option = {
		trigger = { is_galactic_community_member = no }
		name = f93_ralis_crisis_event.0901.b
		ai_chance = {
			factor = 150 # opposes the next option
		}
	}

	option = {
		trigger = {
			event_target:f93_ralis_planet = {
				owner = { is_same_value = event_target:f93_community_ralis_admin_country }
			}
			is_galactic_community_member = no
		}
		name = f93_ralis_crisis_event.0901.c
		f93_give_conquest_to_ralis_admin = yes
		ai_chance = {
			factor = 10
			#self serving empires should oppose it.
			modifier = {
				factor = 0.75
				is_authoritarian = yes
			}
			modifier = {
				factor = 3
				is_egalitarian = yes
			}
			modifier = {
				factor = 5
				is_xenophile = yes
			}
			modifier = {
				factor = 0.2
				is_xenophobe = yes
			}
			modifier = {
				factor = 2
				is_materialist = yes
			}
			modifier = {
				factor = 2
				is_spiritualist = yes
			}
			modifier = {
				factor = 0.5
				is_militarist = yes
			}
			modifier = {
				factor = 4
				is_pacifist = yes
			}
			modifier = {
				factor = 10
				is_galactic_custodian = yes
			}
			modifier = {
				factor = 0.5
				is_gestalt = yes
			}
			modifier = {
				factor = 3
				is_megacorp = yes
			}
			modifier = {
				factor = 0.5
				is_megacorp = yes
				is_worker_coop_empire = no
			}
			modifier = {
				factor = 0.25
				is_in_breach_of_any = yes
			}
		}
	}	
}
#The Community's Claim, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0902
	title = f93_ralis_crisis_event.0902.name
	desc = f93_ralis_crisis_event.0902.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
		
	}
	option = {
		name = f93_ralis_crisis_event.0902.a # keep the plan
		hidden_effect = {
			save_global_event_target_as = f93_ralis_liberator
			event_target:f93_ralis_planet = {
				f93_create_community_ralis_admin_with_station = yes
				solar_system = { set_star_flag = f93_promised_to_ralis_admin }
			}
		}
		every_playable_country = {
			add_opinion_modifier = { modifier = f93_liberator_of_ralis who = root }
		}
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			set_global_flag = f93_community_claim_happened
		}
		
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0902.b #keep ralis
		country_event = { id = f93_ralis_crisis_event.1001}
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis
			set_global_flag = f93_community_claim_denied
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}	
		custom_tooltip = f93_ralis_crisis_event.0902.b_desc
	}

}
#The Community's Request, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0903
	title = f93_ralis_crisis_event.0903.name
	desc = f93_ralis_crisis_event.0903.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
	}
	option = {
		name = f93_ralis_crisis_event.0903.a # keep the plan
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			save_global_event_target_as = f93_ralis_liberator
			set_global_flag = f93_community_gifted
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0903.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
			set_global_flag = f93_community_ignored
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
	}

}
#no treaty path
#The Community's Plea, for everyone but the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0905
	title = f93_ralis_crisis_event.0905.name
	desc = f93_ralis_crisis_event.0905.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
	}
	option = {
		name = f93_ralis_crisis_event.0905.a # keep the plan

		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0905.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
		}
	}

}

# Paper Promises
country_event = {
	id = f93_ralis_crisis_event.1001
	title = f93_ralis_crisis_event.1001.name
	desc = f93_ralis_crisis_event.1001.desc
	picture = GFX_evt_f93_galactic_crossing_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	option = {
		name = OK
	}

}
#post war reconstruction or divided recovery
country_event = {
	id = f93_ralis_crisis_event.1100
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				event_target:f93_ralis_planet = {
					has_planet_flag = f93_galactic_community_claim
				}
			}
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1101 }
			}
		}
		else = {
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1102 }
			}
		}
		
		#event 13 happens 12 years after event 12
		every_playable_country = {
			country_event = { id = f93_ralis_crisis_event.1301 days = 2160 }
		}
	}
}

# Postwar Reconstruction	
country_event = {
	id = f93_ralis_crisis_event.1101
	title = f93_ralis_crisis_event.1101.name
	desc = f93_ralis_crisis_event.1101.desc
	picture = GFX_evt_three_sided_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
		#ralis admin collapses
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1208 days = 360 }
			}
		}
		#the last handover
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1206 days = 360 }
			}
		}
		#a could coup
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1207 days = 360 }
			}
		}
		#treaty fulfilled
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1205 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = OK
	}

}

# a divided recovery
country_event = {
	id = f93_ralis_crisis_event.1102
	title = f93_ralis_crisis_event.1102.name
	desc = f93_ralis_crisis_event.1102.desc
	picture = GFX_evt_f93_galactic_crossing_refugees
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {

		#the legendary gesture
		if = {
			limit = { has_global_flag = f93_community_gifted }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1201 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#the flag of freedom
		if = {
			limit = { has_global_flag = f93_community_gifted }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1203 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.1102.a
		trigger = { is_galactic_community_member = yes }
	}
	option = {
		name = f93_ralis_crisis_event.1102.b
		trigger = { is_galactic_community_member = no }
	}

}

#The Legendary Gesture
country_event = {
	id = f93_ralis_crisis_event.1201
	title = f93_ralis_crisis_event.1201.name
	desc = f93_ralis_crisis_event.1201.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.1201.a
		
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
	}
}

#No Law, No Obligation
country_event = {
	id = f93_ralis_crisis_event.1202
	title = f93_ralis_crisis_event.1202.name
	desc = f93_ralis_crisis_event.1202.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.1202.a
	}
}

#The Flag of Freedom
country_event = {
	id = f93_ralis_crisis_event.1203
	title = f93_ralis_crisis_event.1203.name
	desc = f93_ralis_crisis_event.1203.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.1203.a
	}
}

#a new banner on ralis
country_event = {
	id = f93_ralis_crisis_event.1204
	title = f93_ralis_crisis_event.1204.name
	desc = f93_ralis_crisis_event.1204.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes

	option = {
		name = f93_ralis_crisis_event.1204.a
	}
}


#treaty fulfilled
country_event = {
	id = f93_ralis_crisis_event.1205
	title = f93_ralis_crisis_event.1205.name
	desc = f93_ralis_crisis_event.1205.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
	}
	option = {
		name = f93_ralis_crisis_event.1205.a
		custom_tooltip = f93_ralis_crisis_event.1205.effect
		hidden_effect = {
			every_playable_country = {
				limit = { is_galactic_community_member = yes NOT = { is_same_value = event_target:f93_ralis_liberator } }
				add_opinion_modifier = {
					modifier = f93_ralis_true_liberator
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					every_system_within_border = {
						remove_claims = {
							who = prevprev
							num_of_claims = 100
						}
					}
				}
			}	
			if = {
				limit = { NOT = { has_global_flag = galactic_council_formed } }
				pass_resolution_no_cooldown = resolution_galacticreforms_form_council
			}
			if = {
				limit = { is_part_of_galactic_council = no }
				increase_council_size = yes
			}
			add_permanent_councillor = yes
			add_resource = {
				unity = 10000
			}
			add_modifier = {
				modifier = f93_ralis_true_liberator
				multiplier = 1
			}
			
			if = {
				limit = { exists = event_target:f93_community_ralis_admin_country }
				f93_final_handover_to_ralis_admin = yes
				event_target:f93_community_ralis_admin_country = {
					every_system_within_border = {
						limit = {
							# has_star_flag = f93_ralis_took_it_from_someone
							NOT = { has_star_flag = f93_ralis_empire_cluster }
						}
						save_event_target_as = f93_return_system
						event_target:f93_ralis_liberator = {
							event_target:f93_return_system = {
								if = {
									limit = { has_star_flag = f93_ralis_took_it_from@prev }
									starbase = { set_owner = prevprev }
									every_system_colony = { set_owner = prevprev }
									remove_star_flag = f93_ralis_took_it_from_someone
								}
							}
						}
					}
				}
			}
		}
	}
}

#the last handover
country_event = {
	id = f93_ralis_crisis_event.1206
	title = f93_ralis_crisis_event.1206.name
	desc = f93_ralis_crisis_event.1206.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	option = {
		name = OK
	}	
}

#a Cold Coup
country_event = {
	id = f93_ralis_crisis_event.1207
	title = f93_ralis_crisis_event.1207.name
	desc = f93_ralis_crisis_event.1207.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = {
		has_country_flag = f93_conquered_and_kept_ralis
	}
	option = {
		country_event = { id = f93_ralis_crisis_event.1209 }
	}
}


#Ralis Admin collapses
country_event = {
	id = f93_ralis_crisis_event.1208
	title = f93_ralis_crisis_event.1208.name
	desc = f93_ralis_crisis_event.1208.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				exists = event_target:f93_community_ralis_admin_country
			}
			event_target:f93_community_ralis_admin_country = {
				every_system_within_border = {
					limit = { has_star_flag = f93_ralis_empire_cluster }
					starbase = {
						set_owner = event_target:f93_ralis_liberator
					}
				}
			}
		}
	}
	option = {
		name = OK
		tooltip = {
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = event_target:f93_ralis_liberator }
		}
	}
}

#a quiet verdicts
country_event = {
	id = f93_ralis_crisis_event.1209
	title = f93_ralis_crisis_event.1209.name
	desc = f93_ralis_crisis_event.1209.desc
	picture = GFX_evt_alien_segregation
	is_triggered_only = yes
	option = {
		every_playable_country = {
			limit = { is_galactic_community_member = yes }
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = root }
		}
		remove_from_galactic_community = yes
		
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1300
	hide_window = yes

	mean_time_to_happen = 30

	trigger = {
		has_global_flag = f93_ralis_crisis_event1300_active
		exists = event_target:f93_community_ralis_admin_country
		is_same_value = event_target:f93_community_ralis_admin_country 
	}
	immediate = {
		event_target:f93_community_ralis_admin_country = {
			random_system_within_border = {
				limit = {
					has_star_flag = f93_ralis_took_it_from_someone
					NOT = { has_star_flag = f93_ralis_empire_cluster }
				}
				save_event_target_as = f93_return_system
				random_list = {
					50 = {
						every_playable_country = {
							event_target:f93_return_system = {
								if = {
									limit = { has_star_flag = f93_ralis_took_it_from@prev }
									starbase = { set_owner = prevprev }
									every_system_colony = { set_owner = prevprev planet_event = { id = f93_ralis_crisis_event.1302 } }
									remove_star_flag = f93_ralis_took_it_from_someone
								}
							}
						}
					}
					10 = {
						event_target:f93_return_system = {
							starbase = { set_owner = event_target:f93_ralis_liberator }
							every_system_colony = { set_owner = event_target:f93_ralis_liberator planet_event = { id = f93_ralis_crisis_event.1302 } }
							remove_star_flag = f93_ralis_took_it_from_someone
						}
					}
					40 = {
						modifier = {
							factor = 0
							NOT = { any_system_planet = { is_colony = yes } }
						}
						create_country = {
							name = random
							type = default
							origin = origin_default
							ethos = random
							authority = random
							civics = random
							flag = random
							name_list = random
							ignore_initial_colony_error = yes
							effect = {
								add_resource = {
									minerals = 50
									energy = 150
									alloys = 10
									consumer_goods = 10
									food = 10
									mult = trigger:years_passed
								}
								copy_techs_from = { target = event_target:f93_ralis_liberator }
							}
						}
						every_system_planet = { set_owner = last_created_country }
						starbase = { set_owner = last_created_country }
						every_system = {
							limit = {
								distance = { max_jumps = 2 }
								has_star_flag = f93_ralis_took_it_from_someone
							}
							starbase = { set_owner = last_created_country }
							every_system_colony = { set_owner = last_created_country }
							remove_star_flag = f93_ralis_took_it_from_someone
						}
					}
				}
				remove_star_flag = f93_ralis_took_it_from_someone
				every_fleet_in_system = {
					limit = { owner = { is_same_value = event_target:f93_community_ralis_admin_country } }
					delete_fleet = this
				}
			}
		}
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1301
	title = f93_ralis_crisis_event.1301.name
	desc = f93_ralis_crisis_event.1301.desc
	picture = GFX_evt_f93_galactic_crossing_senate
	is_triggered_only = yes

	immediate = {
		set_global_flag = f93_ralis_crisis_event1300_active
	}
	option = {
		name = f93_ralis_crisis_event.1301.a
	}
	option = {
		name = f93_ralis_crisis_event.1301.b
	}
	after = {
		hidden_effect = {
			country_event = { id = f93_ralis_crisis_event.1401 days = 360 }
			country_event = { id = f93_ralis_crisis_event.1402 days = 360 }
			country_event = { id = f93_ralis_crisis_event.1403 days = 361 }
		}
	}
}

planet_event = {
	id = f93_ralis_crisis_event.1302
	title = f93_ralis_crisis_event.1302.name
	desc = f93_ralis_crisis_event.1302.desc
	picture = GFX_evt_treasure_trove_pirate_fleet
	is_triggered_only = yes
	option = {
		name = f93_ralis_crisis_event.1302.a
	}
}

#the zro must flow
country_event = {
	id = f93_ralis_crisis_event.1401
	title = f93_ralis_crisis_event.1401.name
	desc = f93_ralis_crisis_event.1401.desc
	picture = GFX_evt_f93_galactic_crossing_party
	is_triggered_only = yes

	trigger = {
		#combined these two means the treaty never happened and ralis was kept by liberator
		has_global_flag = f93_community_claim_never_made
		has_global_flag = f93_community_ignored
	}
	immediate = {
		set_global_flag = f93_gal_cartel_cant_happen
		country_event = { id = f93_ralis_crisis_event.1503 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.a
		allow = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } }
		event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 8 } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.b
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.c
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
	}
}
#The Republic of Ralis
country_event = {
	id = f93_ralis_crisis_event.1402
	title = f93_ralis_crisis_event.1402.name
	desc = f93_ralis_crisis_event.1402.desc
	picture = GFX_evt_f93_galactic_crossing_public_announcment
	is_triggered_only = yes
	trigger = {
		event_target:f93_community_ralis_admin_country = {
			any_system_within_border = { is_same_value = event_target:f93_ralis_system }
		}
	}
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1501 days = 960 }
		set_global_flag = f93_gal_cartel_cant_happen
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event1402_happened } }
			event_target:f93_community_ralis_admin_country = {
				set_country_type = default
				set_origin = origin_default
				change_country_flag = {
					icon = { category = "union_state" file = ralis_banner.dds }
					background = { category = "backgrounds" file = "00_solid.dds" }
					colors = {"blue" "dark_blue" "null" "null" }
				}
				clear_ethos = yes
				country_add_ethic = ethic_materialist
				country_add_ethic = ethic_egalitarian
				country_add_ethic = ethic_xenophile
				set_name = "Republic of Ralis"
				copy_techs_from = { target = event_target:f93_ralis_liberator }
				add_opinion_modifier = {
					modifier = f93_legendary_friendship
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					add_opinion_modifier = {
						modifier = f93_legendary_friendship
						who = event_target:f93_community_ralis_admin_country
					}
				}
			}
			event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 10 } }
			set_global_flag = f93_ralis_crisis_event1402_happened
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.1402.a
		tooltip = {
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
			}
		}
	}
}
#A Galactic Cartel
country_event = {
	id = f93_ralis_crisis_event.1403
	title = f93_ralis_crisis_event.1403.name
	desc = f93_ralis_crisis_event.1403.desc
	picture = GFX_evt_f93_galactic_crossing_cat_walk
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f93_gal_cartel_cant_happen }
	}
	immediate = {
		set_global_flag = f93_galactic_cartel_ralis_happened
		country_event = { id = f93_ralis_crisis_event.1502 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1403.a
	}
	option = {
		name = f93_ralis_crisis_event.1403.b
		event_target:f93_ralis_planet = {
			f93_add_zro_cartel = yes
		}
	}
}
#The Zro Syphon
country_event = {
	id = f93_ralis_crisis_event.1404
	hide_window = yes
	mean_time_to_happen = 150

	trigger = {
		any_owned_planet = {
			is_colony = yes f93_has_zro_cartel = yes
		}
	}

	immediate = {
		every_owned_planet = {
			limit = { is_colony = no f93_has_zro_cartel = yes }
			remove_modifier = f93_zro_cartel
			remove_modifier = f93_zro_drone_cartel
		}
		random_owned_planet = {
			limit = { is_colony = yes f93_has_zro_cartel = yes }
			solar_system = {
				closest_system = {
					limit = {
						exists = owner
						starbase = {
							owner = {
								f93_is_zro_cartel_lord = no
							}
						}
						any_system_planet = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
						f93_add_zro_cartel = yes
					}
				}
			}
		}
		export_resource_income_to_variable = {
			resource = sr_zro
			variable = f93_zro_income
		}
		divide_variable = { which = f93_zro_income value = num_owned_planets }

		every_owned_planet = {
			limit = { f93_has_zro_cartel = yes }
			owner = {
				add_resource = {
					sr_zro = -2
					mult = f93_zro_income
				}
			}
			event_target:f93_ralis_planet = {
				owner = {
					set_variable = { which = f93_zro_income value = root.f93_zro_income }
					add_resource = {
						sr_zro = 2
						mult = f93_zro_income
					}
				}
			}
		}
	}
}

#Beyond the Lighthouse
country_event = {
	id = f93_ralis_crisis_event.1501
	title = f93_ralis_crisis_event.1501.name
	desc = f93_ralis_crisis_event.1501.desc
	picture = GFX_evt_f93_galactic_crossing_storm_world
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1501.a
	}
}
#Into the Shadows
country_event = {
	id = f93_ralis_crisis_event.1502
	title = f93_ralis_crisis_event.1502.name
	desc = f93_ralis_crisis_event.1502.desc
	picture = GFX_evt_shroud_tunnel
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1502.a
	}
	option = {
		name = f93_ralis_crisis_event.1502.b
	}
}
#The Eyes that cannot blink.
country_event = {
	id = f93_ralis_crisis_event.1503
	title = f93_ralis_crisis_event.1503.name
	desc = f93_ralis_crisis_event.1503.desc
	picture = GFX_evt_f93_galactic_crossing_dark_eyes
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1503.a
	}
}