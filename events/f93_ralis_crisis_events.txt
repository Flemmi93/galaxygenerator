namespace = f93_ralis_crisis_event

# Ralis Crisis 
#################################
# numbers						#
# first 2 digits are level		#
# 2nd two digits are variance	#
#################################

#Anomalies along the Galactic Crossing
#Happens on midgame trigger
country_event = {
	id = f93_ralis_crisis_event.0001
	# title = f93_ralis_crisis_event.0001.name
	# desc = f93_ralis_crisis_event.0001.desc
	# picture = GFX_evt_ongoing_disaster
	# show_sound = event_whispering
	hide_window = yes
	fire_only_once = yes
	
	# mean_time_to_happen = 1
	is_triggered_only = yes

	trigger = {
	}

	immediate = {
		#log_error = "Crisis event 0001 on [GetDate] by [Root.GetName]"
		#the story is off, this happens
		if = {
			limit = { has_global_flag = f82_button_1_1_off }
			set_global_flag = f93_shroud_gate_active
			event_target:f93_ralis_system = { f93_place_shroud_gate_node = yes }
			while = {
				count = 2
				if = {
					limit = {
						count_system = {
							count > 0 
							limit = { NOT = { exists = starbase } has_star_flag = f93_empty_system_on_galcrossing NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						}
					}
					random_system = {
						limit = { NOT = { exists = starbase } has_star_flag = f93_empty_system_on_galcrossing NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						f93_place_shroud_gate_nexus = yes
					}
				}
				else = {
					random_system = {
						limit = { NOT = { exists = starbase } f93_system_winthin_20_steps_of_galcro = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						f93_place_shroud_gate_nexus = yes
					}
				}
			}
		}
		#this happens when the story is active
		else = {
			#observer_event = { id = f93_ralis_observer_event.0001 }
			set_variable = { which = stars_destroyed value = 0 }
			set_global_flag = f93_ralis_awoken
			# set_country_type = default
			#Fire the Sequence of story first few events.
			every_playable_country = {
				country_event = {
					id = f93_ralis_crisis_event.0002
					days = 360
				}
				country_event = {
					id = f93_ralis_crisis_event.0101
					days = 480
				}
			}
			if = {
				limit = { NOT = { exists = event_target:f93_ralis_subject } }
				f93_create_ralis_vassal_country = yes
			}
			
			event_target:f93_ralis_subject = {
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_country } }
					set_hostile = prev
				}
				country_event = { id = f93_ralis_crisis_event.0004 days = 1 }
			}
			event_target:f93_ralis_country = {
				set_country_type = f93_shrouded_region_crisis
				add_resource = {
					sr_dark_matter = 5
					alloys = 2
					minerals = 0.5
					energy = 3
					food = 0.01
					consumer_goods = 0.25
					unity = 0.1
					mult = 30000
				}
				every_playable_country = { prev = { set_closed_borders = { who = prev status = no } } }
				while = {
					count = 3
					f93_create_ralis_fleet = yes
				}
				add_tradition = tr_supremacy_adopt
				add_tradition = tr_supremacy_fleet_logistical_corps
				add_tradition = tr_supremacy_master_shipwrights
				add_tradition = tr_supremacy_war_games
				add_tradition = tr_supremacy_overwhelming_force
				add_tradition = tr_supremacy_great_game
				add_tradition = tr_supremacy_finish
				if = {
					limit = { has_nemesis = yes }
					add_ascension_perk = ap_become_the_crisis #only works on 4.0 and up
					set_ai_personality = became_the_crisis_f93_shrouded_region_crisis
				}
				
				else = {
					set_ai_personality = fanatic_purifiers_f93_shrouded_region_crisis
				}
				create_fleet = {
					effect = {
						set_owner = event_target:f93_ralis_country
						set_location = event_target:f93_ralis_country.capital_scope
						create_ship = {
							name = random
							random_existing_design = science
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = event_target:f93_ralis_country
						set_location = event_target:f93_ralis_country.capital_scope
						create_ship = {
							name = random
							random_existing_design = science
						}
					}
				}
				if = {
					limit = { NOT = { has_modifier = f93_ralis_difficulty_buff } }
					add_modifier = {
						modifier = f93_ralis_difficulty_buff
						multiplier = 1
					}
				}
			}
			event_target:f93_ralis_system = {
				random_system_megastructure = {
					limit = { is_megastructure_type = crisis_sphere_ruined }
					remove_megastructure = this
				}
				# set_global_flag = f93_shroud_gate_active # moved to a later point
				f93_place_shroud_gate_node = yes
			}
			while = {
				count = 2
				if = {
					limit = {
						count_system = {
							count > 0 
							limit = { NOT = { exists = starbase } has_star_flag = f93_empty_system_on_galcrossing NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						}
					}
					random_system = {
						limit = { NOT = { exists = starbase } has_star_flag = f93_empty_system_on_galcrossing NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						f93_place_shroud_gate_nexus = yes
					}
				}
				else = {
					random_system = {
						limit = { NOT = { exists = starbase } f93_system_winthin_20_steps_of_galcro = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
						f93_place_shroud_gate_nexus = yes
					}
				}
			}
			every_system = {
				limit = {
					OR = {
						AND = {
							exists = space_owner
							space_owner = { is_country_type = fallen_empire }
						}
						has_star_flag = f93_empty_system_on_galcrossing
					}
				}
				set_star_flag = f93_ralis_wont_go_here
			}
			while = {
				count = value:ralis_fleet_attack
				random_system = {
					limit = { f93_system_has_ancient_relay = yes NOR = { has_star_flag = f93_recently_visist has_star_flag = f93_ralis_wont_go_here } }
					set_timed_star_flag = { flag = f93_recently_visist days = 720 }
					star = { save_event_target_as = f93_ralis_target }
				}
				f93_create_ralis_subject_fleet_attack_galcro = yes
				last_created_fleet = {
					while = {
						limit = { fleet_power < value:f93_expected_fleet_power }
						f93_add_random_ship = yes
					}
				}
			}
		}
	}
}
#Anomalies along the Galactic Crossing
country_event = {
	id = f93_ralis_crisis_event.0002
	title = f93_ralis_crisis_event.0001.name
	desc = f93_ralis_crisis_event.0001.desc
	picture = GFX_evt_ongoing_disaster
	show_sound = event_whispering
	# hide_window = yes
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0002 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0002 }
		#for every country a small attack fleet is generated and patrols the galactic crossing.
		
	}
	option = {
		name = WORRYING
	}
}
country_event = {
	id = f93_ralis_crisis_event.0004
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 0004 on [GetDate] by [Root.GetName]"
		event_target:f93_ralis_country = { set_faction_hostility = { target = root set_hostile = no set_neutral = no set_friendly = yes } }
	}
}

# This = starbase being disabled (not ship!)
# From = fleet that disabled the starbase
starbase_event = {
	id = f93_ralis_crisis_event.0005
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_country
		or = {
			from = { owner = { is_same_value = event_target:f93_ralis_country } }
			owner = { is_same_value = event_target:f93_ralis_country }
		}
	}
	immediate = {
		#log_error = "Crisis event 0005 on [GetDate] by [Root.GetName]"
		from = { owner = { save_event_target_as = not_ralis } }
		if = {
			limit = { owner = { is_same_value = event_target:f93_ralis_country } }
			set_owner = event_target:not_ralis
		}
		else = {
			set_owner = event_target:f93_ralis_country
		}
	}
}

# This = starbase being disabled (not ship!)
# From = fleet that disabled the starbase
starbase_event = {
	id = f93_ralis_crisis_event.00052
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_subject
		or = {
			from = { owner = { is_same_value = event_target:f93_ralis_subject } }
			owner = { is_same_value = event_target:f93_ralis_subject }
		}
	}
	immediate = {
		#log_error = "Crisis event 00052 on [GetDate] by [Root.GetName]"
		from = { owner = { save_event_target_as = not_ralis } }
		if = {
			limit = { owner = { is_same_value = event_target:f93_ralis_subject } }
			set_owner = event_target:not_ralis
		}
		else_if = {
			limit = {
				event_target:f93_ralis_country = { is_at_war = yes } 
			}
			set_owner = event_target:f93_ralis_country
		}
	}
}
#Happens after the resolution, which unlocks 10.03. 2 years after midgame
#can take up to a year to conclude
#Earliest around 3-5 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0006
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
		NOT = { has_country_flag = crisis_special_project_4_complete }
	}
	immediate = {
		#log_error = "Crisis event 0006 on [GetDate] by [Root.GetName]"
		country_event = { id = f93_ralis_crisis_event.0006 days = 150 random = 60 }
		if = {
			limit = { has_nemesis = yes }
			# set_country_flag = crisis_sphere_revealed
			if = {
				limit = { has_special_project = CRISIS_SPECIAL_PROJECT_4 }
				complete_special_project = { type =CRISIS_SPECIAL_PROJECT_4 }
				if = {
					limit = { is_at_war = no }
					declare_crisis_effect = yes
				}
				room_name_override = ""
				add_event_chain_counter = {
					event_chain = "become_the_crisis_chain"
					counter = "crisis_level_reached"
					amount = 1
				}
				end_event_chain = become_the_crisis_chain
				country_event = { id = crisis.6000 days = 5 }
				country_event = { id = f93_ralis_crisis_event.00063 days = 360 random = 720 }
			}
			if = {
				limit = { has_special_project = CRISIS_SPECIAL_PROJECT_3 }
				complete_special_project = { type =CRISIS_SPECIAL_PROJECT_3 }
				country_event = { id = crisis.4155 }
				add_event_chain_counter = {
					event_chain = "become_the_crisis_chain"
					counter = "crisis_level_reached"
					amount = 1
				}
			}
			if = {
				limit = { has_special_project = CRISIS_SPECIAL_PROJECT_2 }
				complete_special_project = { type =CRISIS_SPECIAL_PROJECT_2 }
				country_event = { id = crisis.4150 }
				add_event_chain_counter = {
					event_chain = "become_the_crisis_chain"
					counter = "crisis_level_reached"
					amount = 1
				}
			}
			else = {
				limit = { has_special_project = CRISIS_SPECIAL_PROJECT_1 }
				complete_special_project = { type =CRISIS_SPECIAL_PROJECT_1 }
				country_event = { id = crisis.4145 }
				add_event_chain_counter = {
					event_chain = "become_the_crisis_chain"
					counter = "crisis_level_reached"
					amount = 1
				}
			}
		}
	}
}
#this event will slowly progress the engine, each stage taking 10 years +2-5 years cooldown
country_event = {
	id = f93_ralis_crisis_event.00063
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
		is_at_war = yes
		has_nemesis = yes
	}

	immediate = {
		#log_error = "Crisis event 00063 on [GetDate] by [Root.GetName]"
		set_country_flag = crisis_sphere_revealed
		if = {
			limit = { NOT = { exists = event_target:f93_ralis_engine } }
			every_owned_megastructure = {
				limit = { is_megastructure_type = crisis_sphere_0 }
				save_global_event_target_as = f93_ralis_engine
			}
		}
		#wait 2-5 years between upgrades
		country_event = { id = f93_ralis_crisis_event.00063 days = 4320 random = 1080 }
		if = {
			limit = { event_target:f93_ralis_engine = { is_megastructure_type = crisis_sphere_0 } }
			event_target:f93_ralis_engine = { upgrade_megastructure_to = crisis_sphere_1 }
		}
		if = {
			limit = { event_target:f93_ralis_engine = { is_megastructure_type = crisis_sphere_1 } }
			event_target:f93_ralis_engine = { upgrade_megastructure_to = crisis_sphere_2 }
		}
		if = {
			limit = { event_target:f93_ralis_engine = { is_megastructure_type = crisis_sphere_2 } }
			event_target:f93_ralis_engine = { upgrade_megastructure_to = crisis_sphere_3 }
		}
		if = {
			limit = { event_target:f93_ralis_engine = { is_megastructure_type = crisis_sphere_3 } }
			event_target:f93_ralis_engine = { upgrade_megastructure_to = crisis_sphere_4 }
		}
	}
}
#this event is a backup in case a player does not have nemesis or something else malfunctions
#lor for example adds nemesis exactly after the resolution.
country_event = {
	id = f93_ralis_crisis_event.00062
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	# trigger = {
	# 	exists = event_target:f93_ralis_country
	# 	is_same_value = event_target:f93_ralis_country
	# }

	immediate = {
		#log_error = "Crisis event 00062 on [GetDate] by [Root.GetName]"
		#Activates the Shrouded Hyperlanes
		country_event = { id = f93_ralis_crisis_event.00064 }
		if = {
			limit = {
				has_nemesis = yes
				event_target:f93_ralis_country = { not = { has_country_flag = crisis_sphere_revealed } }
			}
			country_event = { id = f93_ralis_crisis_event.00063 }
		}
		else = {
			save_event_target_as = new_galactic_threat
			f93_threat_war_effect = yes
		}
	}
}
#Activates the Shrouded Hyperlanes (ralisgate bypass)
country_event = {
	id = f93_ralis_crisis_event.00064
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#log_error = "Crisis event 00064 on [GetDate] by [Root.GetName]"
		set_global_flag = f93_shroud_gate_active
		every_system = {
			limit = { has_star_flag = f93_ralis_empire_cluster }
			remove_star_flag = sealed_system
		}
	}
}

#A galaxy holds its breath
#Happens 120 days after midgame 
country_event = {
	id = f93_ralis_crisis_event.0101
	title = f93_ralis_crisis_event.0101.name
	desc = f93_ralis_crisis_event.0101.desc
	picture = GFX_evt_supernova
	show_sound = event_screams
	
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_country
	}
	immediate = {
		#log_error = "Crisis event 0101 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0101 }
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event0101_happened } }
			set_global_flag = f93_ralis_crisis_event0101_happened
			country_event = { id = f93_ralis_crisis_event.0102 }
		}
	}
	option = {
		name = f93_ralis_crisis_event.0101.a
		country_event = { id = f93_ralis_crisis_event.0201 days = 30 }
	}
}

country_event = {
	id = f93_ralis_crisis_event.0102
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		#log_error = "Crisis event 0102 on [GetDate] by [Root.GetName]"
		every_system = {
			limit = {
				any_neighbor_system = { f93_system_has_ancient_relay = yes }
				NOR = {
					has_star_flag = f93_empty_system_on_galcrossing
					AND = {
						exists = space_owner
						space_owner = {
							OR = {
								is_country_type = fallen_empire
								is_country_type = dormant_marauders
							}
						}
					}
					AND = {
						exists = space_owner
						space_owner = {
							OR = {
								is_ai = no
								NOT = { has_global_flag = f82_button_1_2_on }
							}
						}
					}
				}
			}
			random_list = {
				13 = {
					# set_name = "AGHIB"
					#destroys a system and spawns a in a ralis fleet to guard it
					system_event = { id = f93_ralis_crisis_event.0103 }
					random_system_planet = {
						save_event_target_as = f93_ralis_target
					}
					f93_create_ralis_subject_fleet = yes
					last_created_fleet = {
						set_fleet_flag = ralis_fleet_gal_cro_occupier
						set_location = {
							target = event_target:f93_ralis_target
							angle = random
							distance = 300
						}
						auto_move_to_planet = {
							target = event_target:f93_ralis_target
							clear_auto_move_on_arrival = yes
						}
					}
				}
				12 = {
					# set_name = "AGHIB"
					#destroys a system and spawns NO ralis fleet to guard it
					system_event = { id = f93_ralis_crisis_event.0103 }
					random_system_planet = {
						save_event_target_as = f93_ralis_target
					}
					last_created_fleet = {
						set_fleet_flag = ralis_fleet_gal_cro_occupier
						set_location = {
							target = event_target:f93_ralis_target
							angle = random
							distance = 300
						}
						auto_move_to_planet = {
							target = event_target:f93_ralis_target
							clear_auto_move_on_arrival = yes
						}
					}
				}
				75 = {}
			}
		}
	}
}

#our system destroy event, much narrower
system_event = {
	id = f93_ralis_crisis_event.0103
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		f93_ok_to_be_destroyed = yes
		NOT = { any_neighbor_system = { exists = space_owner space_owner = { is_country_type = fallen_empire } } }
	}
	immediate = {
		#log_error = "Crisis event 0103 on [GetDate] by [Root.GetName]"
		# set_name = "DESTROYED"
		# if = {
		# 	limit = { exists = space_owner space_owner = { is_country_type = default } }
		# 	every_system_colony = {
		# 		every_owned_pop_group = {	
		# 			limit = { is_valid_refugee_pop = yes }
		# 			save_event_target_as = refugee_pop #Must be saved for refugee_pop_effect to work
		# 			refugee_pop_effect = yes
		# 		}
		# 	}
		# }
		# the following replaces destroy_star_system only blowing up planets, leaving fleets
		set_star_flag = star_cracked
		set_star_class = sc_black_hole
		every_system_ambient_object = {
			destroy_ambient_object = this
		}
		every_system_planet = {
			limit = { is_star = yes }
			change_pc = pc_black_hole
			random_list = {
				5 = { add_deposit = random }
				3 = { }
				1 = { add_deposit = random add_deposit = random }
			}
		}
		every_system_planet = {
			limit = {
				is_star = no
				is_asteroid = no
				NOR = {
					is_planet_class = pc_shattered
					is_planet_class = pc_shattered_2
					is_planet_class = pc_shielded
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_seam_damaged
				}
			}
			if = {
				limit = { is_planet_class = pc_habitat } # uncolonized
				spawn_habitat_cracker_effect = yes
			}
			if = {
				limit = { is_colony = yes }
				if = {
					limit = {
						exists = orbital_defence
					}
					destroy_fleet = orbital_defence
				}
				remove_all_buildings = yes
				destroy_colony = yes
				if = {
					limit = { is_planet_class = pc_habitat }
					spawn_habitat_cracker_effect = yes
				}
				else_if = {
					limit = { is_ringworld = yes }
					spawn_ringworld_cracker_effect = yes
					change_pc = pc_ringworld_habitable_damaged
				}
				else = {
					change_pc = pc_shattered
				}
			}
			else_if = {
				limit = { is_ringworld = yes }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_habitable_damaged
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_tech }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_tech_damaged
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_seam }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_seam_damaged
			}
			else = {
				change_pc = pc_shattered
			}
		}
		every_system_planet = {
			limit = {
				exists = orbital_station
			}
			orbital_station = { dismantle = yes }
		}
		every_system_planet = {
			clear_deposits = yes
			clear_planet_modifiers = yes
			prevent_anomaly = yes
		}
		every_system_planet = {
			limit = { is_asteroid = yes }
			clear_deposits = yes
			random_list = {
				5 = { add_deposit = random }
				3 = { }
				1 = { add_deposit = random add_deposit = random }
			}
		}
		every_fleet_in_system = {
			limit = {
				NOR = {
					is_same_value = from
					# except Extradimensionals
					AND = {
						exists = owner
						owner = {
							OR = {
								is_country_type = portal_holder
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					# except biggest monsters
					any_owned_ship = {
						OR = {
							is_ship_size = behemoth_04
							is_ship_size = voidspawn_boss
						}
					}
				}
			}
			destroy_fleet = this
		}
		every_system_megastructure = {
			set_ruined_megastructure = yes
		}
		star = {
			create_ambient_object = {
				type = "destroyed_system"
				location = this
			}
			last_created_ambient_object = {
				set_ambient_object_flag = destroyed_system_effect
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		remove_system_terraforming_candidates = yes

		every_system_planet = { reroll_deposits = yes }
		event_target:f93_ralis_country = {
			change_variable = { which = stars_destroyed value = 1 }
		}
		closest_system = {
			limit = { exists = space_owner space_owner = { is_country_type = default } }
			set_star_flag = f93_ralis_crisis_event_got_hit_flag
		}
		random_country = {
				limit = {
					is_ai = yes
					is_country_type = default
					any_system_within_border = { has_star_flag = f93_ralis_crisis_event_got_hit_flag }
				}
				save_global_event_target_as = f93_to_be_killed_by_ralis
			}
			if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
						f93_is_close_to_highway = yes
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_country_type = default
						f93_is_close_to_highway = yes
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
	}
}

#Senate Report
#Happens 150 Days after midgame
country_event = {
	id = f93_ralis_crisis_event.0201
	title = f93_ralis_crisis_event.0201.name
	desc = f93_ralis_crisis_event.0201.desc
	picture = GFX_evt_astral_rift_ancient_battlegrounds
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 0201 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0201 }
		
		if = {
			limit = {
				exists = event_target:f93_to_be_killed_by_ralis
				NOT = { has_global_flag = f93_ralis_crisis_event0201_happened }
			}
			set_global_flag = f93_ralis_crisis_event0201_happened
			event_target:f93_to_be_killed_by_ralis = {
				# every_system_within_border = {
				# 	limit = { f93_ok_to_be_destroyed = no any_system_planet = { is_colony = yes } }
				# 	# destroy_star_system = yes
				# 	# system_event = { id = f93_ralis_crisis_event.0103 }
				# 	# every_system_planet = { reroll_deposits = yes }
				# }
				while = {
					limit = { any_owned_planet = { exists = this } }
					random_owned_planet = {
						solar_system = {
							destroy_star_system = yes
							every_system_planet = {
								limit = { is_star = yes }
								reroll_deposits = yes
							}
						}
					}
				}
				# destroy_country = yes
			}
			event_target:f93_ralis_country = {
				if = {
					limit = { is_ai = yes }
					add_resource = {
						menace = 10000
					}
					set_timed_country_flag = {
						flag = f93_recently_advanced_crisis
						days = 90
					}
				}
				capital_scope = { set_name = ralis_planet_NAME }
				
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.0201.a
	}
	after = { country_event = { id = f93_ralis_crisis_event.0301 days = 180 } }
}

#Receding of the Abyss
#Happens 330 days after midgame
country_event = {
	id = f93_ralis_crisis_event.0301
	title = f93_ralis_crisis_event.0301.name
	desc = f93_ralis_crisis_event.0301.desc
	picture = GFX_evt_treasure_trove_pirate_fleet
	
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 0301 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0301 }
		set_global_flag = f93_ralis_arms_race_active
	}
	option = {
		name = f93_ralis_crisis_event.0301.a
	}
	option = {
		name = f93_ralis_crisis_event.0301.b
	}

	after = {
	}
}
#Happens on yearly pulse at least 0.5 year after midgame the 1.1. of 2nd year of midgame
country_event = {
	id = f93_ralis_crisis_event.0400
	hide_window = yes
	fire_only_once = yes
	# mean_time_to_happen = 1
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		mid_game_years_passed > 0
		exists = event_target:f93_ralis_country
		# OR = {
		# 	AND = {
		# 		has_nemesis = yes
		# 		event_target:f93_ralis_country = {
		# 			OR = {
		# 				has_crisis_level = crisis_level_2
		# 				has_crisis_level = crisis_level_3
		# 				has_crisis_level = crisis_level_4
		# 				has_crisis_level = crisis_level_5
		# 			}
		# 		}
		# 	}
		# 	AND = {
		# 		has_nemesis = no
		# 		mid_game_years_passed >= 3
		# 	}
		# }
	}
	immediate = {
		#log_error = "Crisis event 0400 on [GetDate] by [Root.GetName]"
		every_playable_country = {
			country_event = { id = f93_ralis_crisis_event.0401 days = 370 }
			#Spawn an Attack fleet vor 1/3 of Empires
			random_list = {
				1 = {
					capital_scope = {
						save_event_target_as = f93_ralis_target
						f93_create_ralis_subject_fleet_attack = yes
					}
					event_target:f93_ralis_subject = { change_variable = { which = attack_fleet_limit value = 1 } }
				}
				2 = {}
			}
		}
	}
}
#Secrets of Ralis
#happens 10.01. 2 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0401
	title = f93_ralis_crisis_event.0401.name
	desc = f93_ralis_crisis_event.0401.desc
	picture = GFX_evt_cosmic_storms_the_storm_speaks
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0401 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0401 }
	}
	option = {
		name = f93_ralis_crisis_event.0401.a
		country_event = { id = f93_ralis_crisis_event.0501 days = 90 }
	}
	after = {}
}

#The War Plan Debate
# happens 10.03. 2 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0501
	title = f93_ralis_crisis_event.0501.name
	desc = f93_ralis_crisis_event.0501.desc
	picture = GFX_evt_civil_action
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	trigger = {
	}
	immediate = {
		#log_error = "Crisis event 0501 on [GetDate] by [Root.GetName]"
		set_global_flag = f93_activate_ralis_resolution_1
	}
	option = {
		name = f93_ralis_crisis_event.0501.a
		custom_tooltip = f93_ralis_crisis_event.0501.a_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_a
		}
		trigger = { any_country = { is_proposing_resolution = f93_ralis_plan_resolution } }
	}
	option = {
		name = f93_ralis_crisis_event.0501.a
		custom_tooltip = f93_ralis_crisis_event.0501.c_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_a
			propose_resolution = {
				resolution = f93_ralis_plan_resolution
				target = event_target:f93_ralis_country
			}
		}
		allow = { NOR = { is_proposing_resolution = any } }
		trigger = { NOT = { any_country = { is_proposing_resolution = f93_ralis_plan_resolution } } }
	}
	option = {
		name = f93_ralis_crisis_event.0501.b
		custom_tooltip = f93_ralis_crisis_event.0501.b_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_b
		}
	}
	after = {
		establish_communications = event_target:f93_ralis_country
	}
}

#Happens after the Resolution is passed
#Resolution unlocks on 10.03. 2 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0601
	title = f93_ralis_crisis_event.0601.name
	desc = f93_ralis_crisis_event.0601.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0601 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0601 }
		# event_target:f93_ralis_country = {
		# 	remove_modifier = f93_ralis_science_stop
		# 	add_modifier = {
		# 		modifier = f93_ralis_science_stop
		# 		multiplier = -1
		# 	}
		# }
		every_playable_country = {
			limit = { NOT = { has_country_flag = ralis_country_flag } }
			every_system_within_border = {
				set_star_flag = f93_ralis_took_it_from@prev
			}
		}
	}
	option = {
		allow = {
			OR = {
				is_egalitarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophile = yes
				is_megacorp = yes
				is_gestalt = yes
			}
		}
		name = f93_ralis_crisis_event.0601.a
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty
		}
	}
	option = {
		allow = {
			OR = {
				is_authoritarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophobe = yes
				is_gestalt = yes
			}
		}
		name = f93_ralis_crisis_event.0601.b
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty_unwillingly
		}
	}
	option = {
		trigger = { is_ai = yes }
		name = OK
	}
	option = {
		trigger = { is_ai = no }
		name = f93_ralis_crisis_event.0601.c
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_rejected_treaty
		}
		remove_from_galactic_community = yes
	}
	
}
#The War plan treaty failed
#Happens after the Resolution is passed
#Resolution unlocks on 10.03. 2 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0602
	title = f93_ralis_crisis_event.0602.name
	desc = f93_ralis_crisis_event.0602.desc
	picture = GFX_evt_two_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0602 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0602 }
		# event_target:f93_ralis_country = {
		# 	remove_modifier = f93_ralis_science_stop
		# 	add_modifier = {
		# 		modifier = f93_ralis_science_stop
		# 		multiplier = -1
		# 	}
		# }
	}
	option = {
		name = f93_ralis_crisis_event.0602.a
	}
}
#The War plan treaty passed and tells everyone else about it
#Happens after the Resolution is passed
#Resolution unlocks on 10.03. 2 years after midgame
country_event = {
	id = f93_ralis_crisis_event.0603
	title = f93_ralis_crisis_event.0603.name
	desc = f93_ralis_crisis_event.0603.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = no
	}
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0603 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0603 }
	}
	option = {
		name = OK
	}
}

#tracking what system was conquered from who by ralis
#this event gives ralis all colonies instantly, so ralis has less insentive to crack the star

# From = system
# FromFrom = country (new owner)
# This = country (previous owner)
# country_event = {
# 	id = f93_ralis_crisis_event.0606
# 	hide_window = yes
# 	# mean_time_to_happen = 15
# 	is_triggered_only = yes
	
# 	trigger = {
# 		exists = event_target:f93_ralis_country
# 		exists = space_owner
# 		FROMFROM = { is_same_value = event_target:f93_ralis_country }
# 		is_ai = yes
# 		event_target:f93_ralis_country = { is_at_war = yes }
# 	}
# 	immediate = {
		# #log_error = "Crisis event 0606 on [GetDate] by [Root.GetName]"
# 		from = {
# 			random_list = {
# 				1 = {}
# 				2 = { 
# 					# due to ai missmanagment and no fun factor, disabled for now
# 					# setting occupation does not work due to wargoal
# 					# every_system_colony = { set_owner = event_target:f93_ralis_country }
# 				}
# 			}
# 		}
# 	}
# }

# From = system
# FromFrom = country (new owner)
# This = country (previous owner)
country_event = {
	id = f93_ralis_crisis_event.0604
	hide_window = yes
	# mean_time_to_happen = 15
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:f93_ralis_country
		exists = space_owner
		FROMFROM = { is_same_value = event_target:f93_ralis_country }
		event_target:f93_ralis_country = { is_at_war = yes }
	}

	immediate = {
		#log_error = "Crisis event 0604 on [GetDate] by [Root.GetName]"
		if = {
			limit = { FROM = { NOT = { has_star_flag = f93_belonged_to_ralis } } }
			FROM = {
				set_star_flag = f93_ralis_took_it_from_someone
				#last owner could be someone else every time, this is intentional.
				set_star_flag = f93_ralis_took_it_from@root
			}
		}
	}
}

#anyone entering ralis system for the first time
ship_event = {
	id = f93_ralis_crisis_event.0701
	title = f93_ralis_crisis_event.0701.name
	desc = f93_ralis_crisis_event.0701.desc
	picture = GFX_evt_situation_the_seal
	# show_sound = event_mystic_reveal
	# mean_time_to_happen = 30
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		FROM = { has_star_flag = f93_ralis_system }
		FromFrom = { NOT = { has_country_flag = f93_seen_ralis } }
	}
	immediate = {
		#log_error = "Crisis event 0701 on [GetDate] by [Root.GetName]"
		FromFrom = { set_country_flag = f93_seen_ralis }
	}
	option = {
		name = f93_ralis_crisis_event.0701.a
	}
}


# A fleet has entered a system | See also: on_fleet_auto_move_arrival
#A Fleet Entering Ralis during the War
# Scope = Fleet
# From = System
fleet_event = {
	id = f93_ralis_crisis_event.0702
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:f93_ralis_country
		from = { is_same_value = event_target:f93_ralis_system }
		exists = owner
		owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
		event_target:f93_ralis_country = { is_at_war = yes }
		event_target:f93_ralis_system = {
			any_fleet_in_system = {
				is_ship_class = shipclass_military
				owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
				NOT = { has_fleet_flag = f93_ralis_already_saw_this }
			}
		}
	}

	immediate = {
		#log_error = "Crisis event 0702 on [GetDate] by [Root.GetName]"
		set_timed_fleet_flag = {
			flag = f93_ralis_already_saw_this
			days = 30
		}
		#send home closest fleet
		event_target:f93_ralis_system = {
			closest_system = {
				limit = {
					any_fleet_in_system = {
						owner = { is_same_value = event_target:f93_ralis_country }
						is_ship_class = shipclass_military
					}
				}
				every_fleet_in_system = {
					limit = {
						owner = { is_same_value = event_target:f93_ralis_country }
						is_ship_class = shipclass_military
					}
					auto_move_to_planet = { target = event_target:f93_ralis_planet clear_auto_move_on_arrival = yes }
				}
			}
		}
		#send home strongest fleet
		event_target:f93_ralis_country = {
			ordered_controlled_fleet = {
				limit = {
					is_ship_class = shipclass_military
				}
				position = 0
				order_by = trigger:fleet_power
				auto_move_to_planet = { target = event_target:f93_ralis_planet clear_auto_move_on_arrival = yes }
			}
		}
	}
}


planet_event = {
	id = f93_ralis_crisis_event.0800
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		is_same_value = event_target:f93_ralis_planet
		event_target:f93_ralis_planet = {
			is_colony = no
		}
	}

	immediate = {
		#log_error = "Crisis event 0800 on [GetDate] by [Root.GetName]"
		every_country = { country_event = { id = f93_ralis_crisis_event.0801 } }
	}
}
#ralis is destroyed
#nothing happens, the story ends here.
country_event = {
	id = f93_ralis_crisis_event.0801
	title = f93_ralis_crisis_event.0801.name
	desc = f93_ralis_crisis_event.0801.desc
	picture = GFX_evt_large_explosion
	# show_sound = event_mystic_reveal

	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0801 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0801 }
	}
	option = {
		name = f93_ralis_crisis_event.0801.a
	}
}
# debug effect to trigger the even 0802, needs to be fired form empire overview window. (F1)
# effect event_target:f93_ralis_planet = { planet_event = { id = f93_ralis_crisis_event.0802 from = root fromfrom = event_target:f93_ralis_country } } event_target:f93_ralis_country = { every_owned_megastructure = { limit = { OR = { is_megastructure_type = crisis_sphere_0 is_megastructure_type = crisis_sphere_1 is_megastructure_type = crisis_sphere_2 is_megastructure_type = crisis_sphere_3 is_megastructure_type = crisis_sphere_4 } } remove_megastructure = this } }

# This = Planet scope
# From = Country scope (new owner)
# FromFrom = Former Owner
#ralis is conquered
planet_event = {
	id = f93_ralis_crisis_event.0802
	title = f93_ralis_crisis_event.0802.name
	desc = f93_ralis_crisis_event.0802.desc
	picture = GFX_evt_burning_city
	# mean_time_to_happen = 1
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = f82_button_1_1_off
			has_global_flag = f93_ralis_defeated_for_good
		}
		is_same_value = event_target:f93_ralis_planet
		owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
		NOT = { has_planet_flag = f93_recently_conquered }
	}
	immediate = {
		#log_error = "Crisis event 0802 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0802 }
		owner = { save_global_event_target_as = f93_ralis_liberator }
		event_target:f93_ralis_country = {
			set_name = ralis_remnant_NAME
		}
		set_timed_planet_flag = {
			flag = f93_recently_conquered
			days = 30
		}
		#sometimes ralis insatly flips back, this is just ensurance
		event_target:f93_ralis_planet = {
			planet_event = { id = f93_ralis_crisis_event.0803 days = 1 }
			planet_event = { id = f93_ralis_crisis_event.0803 days = 2 }
			planet_event = { id = f93_ralis_crisis_event.0803 days = 3 }
		}
	}
	option = {
		name = f93_ralis_crisis_event.0802.a 
		hidden_effect = {
			#treaty paths
			if = {
				limit = {
					event_target:f93_ralis_planet = { has_planet_flag = f93_galactic_community_claim }
				}
				#The Community's Mandate
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0901 days = 360 }
				}
				#The Community's Claim
				if = {
					limit = {
						event_target:f93_ralis_liberator = {
							is_galactic_community_member = yes
						}
					}
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0902 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_community_liberator
						}
					}
				}
				#The Community’s Request
				else = {
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_independent_liberator
						}
					}
				}
			}
			#no treaty path
			else = {
				#The Community’s Request
				event_target:f93_ralis_liberator = {
					country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
				}
				#The Community’s Plea
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0905 days = 360 }
				}
			}
		}
	}
}

#forces the planet ralis to be given to its proper owner again
planet_event = {
	id = f93_ralis_crisis_event.0803
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 0803 on [GetDate] by [Root.GetName]"
		if = {
			#for modders, use this flag to prevent this mod from changing ralis again
			limit = { NOT = { has_global_flag = f94_ralis_not_pc_city } }
			change_pc = pc_city
		}
		if = {
			limit = { exists = event_target:f93_ralis_liberator }
			set_owner = event_target:f93_ralis_liberator
			starbase = { set_owner = event_target:f93_ralis_liberator }
		}
		else = {
			set_owner = event_target:f93_ralis_country
			starbase = { set_owner = event_target:f93_ralis_country }
		}
	}
}
#Treaty Path
#The Community's Mandate, shown to all but the Ralis Liberator
country_event = {
	id = f93_ralis_crisis_event.0901
	title = f93_ralis_crisis_event.0901.name
	desc = f93_ralis_crisis_event.0901.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
		has_country_flag = f93_com_mandate_can_happen
	}
	immediate = {
		#log_error = "Crisis event 0901 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0901 }
	}
	#hand systems over to administration
	option = { 
		name = f93_ralis_crisis_event.0901.a
		trigger = { is_galactic_community_member = yes }
		f93_give_conquest_to_ralis_admin = yes
		every_playable_country = {
			limit = { is_galactic_community_member = yes }		
			add_opinion_modifier = { modifier = f93_kept_ralis_treaty who = root }
		}
		ai_chance = {
			factor = 50 # opposes the last option
		}
	}
	option = {
		trigger = { is_galactic_community_member = yes is_ai = no }
		name = f93_ralis_crisis_event.0901.d
		allow = { always = no }
	}
	option = {
		trigger = { is_galactic_community_member = no }
		name = f93_ralis_crisis_event.0901.b
		ai_chance = {
			factor = 150 # opposes the next option
		}
	}

	option = {
		trigger = {
			event_target:f93_ralis_planet = {
				owner = { is_same_value = event_target:f93_community_ralis_admin_country }
			}
			is_galactic_community_member = no
		}
		name = f93_ralis_crisis_event.0901.c
		f93_give_conquest_to_ralis_admin = yes
		ai_chance = {
			factor = 10
			#self serving empires should oppose it.
			modifier = {
				factor = 0.75
				is_authoritarian = yes
			}
			modifier = {
				factor = 3
				is_egalitarian = yes
			}
			modifier = {
				factor = 5
				is_xenophile = yes
			}
			modifier = {
				factor = 0.2
				is_xenophobe = yes
			}
			modifier = {
				factor = 2
				is_materialist = yes
			}
			modifier = {
				factor = 2
				is_spiritualist = yes
			}
			modifier = {
				factor = 0.5
				is_militarist = yes
			}
			modifier = {
				factor = 4
				is_pacifist = yes
			}
			modifier = {
				factor = 10
				is_galactic_custodian = yes
			}
			modifier = {
				factor = 0.5
				is_gestalt = yes
			}
			modifier = {
				factor = 3
				is_megacorp = yes
			}
			modifier = {
				factor = 0.5
				is_megacorp = yes
				is_worker_coop_empire = no
			}
			modifier = {
				factor = 0.25
				is_in_breach_of_any = yes
			}
		}
	}	
}
#The Community's Claim, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0902
	title = f93_ralis_crisis_event.0902.name
	desc = f93_ralis_crisis_event.0902.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
	}
	immediate = {
		#log_error = "Crisis event 0902 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0902 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
		every_playable_country = {
			set_country_flag = f93_com_mandate_can_happen
		}
	}
	option = {
		name = f93_ralis_crisis_event.0902.a # keep the plan
		hidden_effect = {
			event_target:f93_ralis_planet = {
				f93_create_community_ralis_admin_with_station = yes
				solar_system = { set_star_flag = f93_promised_to_ralis_admin }
			}
		}
		every_playable_country = {
			add_opinion_modifier = { modifier = f93_liberator_of_ralis who = root }
		}
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			set_global_flag = f93_community_claim_happened
		}
		
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0902.b #keep ralis
		country_event = { id = f93_ralis_crisis_event.1001}
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis
			set_global_flag = f93_community_claim_denied
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}	
		custom_tooltip = f93_ralis_crisis_event.0902.b_desc
	}
	after = {
		if = {
			limit = { exists = event_target:f93_ralis_subject }
			event_target:f93_ralis_subject = {
				destroy_country = yes
			}
		}
	}
}
#The Community's Request, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0903
	title = f93_ralis_crisis_event.0903.name
	desc = f93_ralis_crisis_event.0903.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
	}
	immediate = {
		#log_error = "Crisis event 0903 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0903 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
		every_playable_country = {
			set_country_flag = f93_com_mandate_can_happen
		}
	}
	option = {
		name = f93_ralis_crisis_event.0903.a # keep the plan
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			set_global_flag = f93_community_gifted
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0903.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
			set_global_flag = f93_community_ignored
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
	}

	after = {
		if = {
			limit = { exists = event_target:f93_ralis_subject }
			event_target:f93_ralis_subject = {
				destroy_country = yes
			}
		}
	}
}
#no treaty path
#The Community's Plea, shown to all but the Ralis Liberator
country_event = {
	id = f93_ralis_crisis_event.0905
	title = f93_ralis_crisis_event.0905.name
	desc = f93_ralis_crisis_event.0905.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
		has_country_flag = f93_com_mandate_can_happen
	}
	immediate = {
		#log_error = "Crisis event 0905 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.0905 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
	}
	option = {
		name = f93_ralis_crisis_event.0905.a # keep the plan

		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0905.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
		}
	}

}

# Paper Promises
country_event = {
	id = f93_ralis_crisis_event.1001
	title = f93_ralis_crisis_event.1001.name
	desc = f93_ralis_crisis_event.1001.desc
	picture = GFX_evt_f93_galactic_crossing_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 1001 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1001 }
	}
	option = {
		name = OK
	}

}
#post war reconstruction or divided recovery
country_event = {
	id = f93_ralis_crisis_event.1100
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 1100 on [GetDate] by [Root.GetName]"
		if = {
			limit = {
				event_target:f93_ralis_planet = {
					has_planet_flag = f93_galactic_community_claim
				}
			}
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1101 }
			}
		}
		else = {
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1102 }
			}
		}
		country_event = { id = f93_ralis_crisis_event.1103 days = 10 }
		every_playable_country = {
		#event 13 happens 6 years after event 12
			country_event = { id = f93_ralis_crisis_event.1301 days = 2160 }
		#event OE9 post war event 10 years after event 12
			every_playable_country = { country_event = { id = f93_oe_event.9 days = 3960 } }
		}
	}
}

# Postwar Reconstruction	
country_event = {
	id = f93_ralis_crisis_event.1101
	title = f93_ralis_crisis_event.1101.name
	desc = f93_ralis_crisis_event.1101.desc
	picture = GFX_evt_three_sided_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 1101 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1101 }
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
		#ralis admin collapses
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1208 days = 360 }
			}
		}
		#the last handover
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1206 days = 360 }
			}
		}
		#a could coup
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1207 days = 360 }
			}
		}
		#treaty fulfilled
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1205 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = OK
	}

}

# a divided recovery
country_event = {
	id = f93_ralis_crisis_event.1102
	title = f93_ralis_crisis_event.1102.name
	desc = f93_ralis_crisis_event.1102.desc
	picture = GFX_evt_f93_galactic_crossing_refugees
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 1102 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1102 }
		#the legendary gesture
		if = {
			limit = { has_global_flag = f93_community_gifted }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1201 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#the flag of freedom
		if = {
			limit = { has_global_flag = f93_community_gifted }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1203 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.1102.a
		trigger = { is_galactic_community_member = yes }
	}
	option = {
		name = f93_ralis_crisis_event.1102.b
		trigger = { is_galactic_community_member = no }
	}

}

country_event = {
	id = f93_ralis_crisis_event.1103
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		#log_error = "Crisis event 1103 on [GetDate] by [Root.GetName]"
		event_target:f93_ralis_country = {
			every_owned_planet = {
				set_owner = event_target:f93_community_ralis_admin_country
			}
			every_system_within_border = {
				starbase = {
					set_owner = event_target:f93_community_ralis_admin_country
				}
			}
			destroy_country = yes
		}
	}
}

#The Legendary Gesture
country_event = {
	id = f93_ralis_crisis_event.1201
	title = f93_ralis_crisis_event.1201.name
	desc = f93_ralis_crisis_event.1201.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1201 } }
	immediate = {
		#log_error = "Crisis event 1201 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1201 }
		set_country_flag = has_seen_f93_ralis_crisis_event1201
	}
	option = {
		name = f93_ralis_crisis_event.1201.a
		
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
	}
}

#No Law, No Obligation
country_event = {
	id = f93_ralis_crisis_event.1202
	title = f93_ralis_crisis_event.1202.name
	desc = f93_ralis_crisis_event.1202.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1202 } }
	immediate = {
		#log_error = "Crisis event 1202 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1202 }
		set_country_flag = has_seen_f93_ralis_crisis_event1202
		set_global_flag = f93_community_claim_never_made # it did, but the liberator left the community to conquer ralis on their own
	}
	option = {
		name = f93_ralis_crisis_event.1202.a
		if = {
			limit = {
				exists = event_target:f93_community_ralis_admin_country
			}
			event_target:f93_community_ralis_admin_country = {
				every_system_within_border = {
					limit = { has_star_flag = f93_ralis_empire_cluster }
					starbase = {
						set_owner = event_target:f93_ralis_liberator
					}
				}
			}
		}
	}
}

#The Flag of Freedom
country_event = {
	id = f93_ralis_crisis_event.1203
	title = f93_ralis_crisis_event.1203.name
	desc = f93_ralis_crisis_event.1203.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1203 } }
	immediate = {
		#log_error = "Crisis event 1203 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1203 }
		set_country_flag = has_seen_f93_ralis_crisis_event1203
	}
	option = {
		name = f93_ralis_crisis_event.1203.a
	}
}

#a new banner on ralis
country_event = {
	id = f93_ralis_crisis_event.1204
	title = f93_ralis_crisis_event.1204.name
	desc = f93_ralis_crisis_event.1204.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1204 } }
	immediate = {
		#log_error = "Crisis event 1204 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1204 }
		set_country_flag = has_seen_f93_ralis_crisis_event1204
	}
	option = {
		name = f93_ralis_crisis_event.1204.a
	}
}


#treaty fulfilled
country_event = {
	id = f93_ralis_crisis_event.1205
	title = f93_ralis_crisis_event.1205.name
	desc = f93_ralis_crisis_event.1205.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#log_error = "Crisis event 1205 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1205 }
	}
	option = {
		name = f93_ralis_crisis_event.1205.a
		custom_tooltip = f93_ralis_crisis_event.1205.effect
		hidden_effect = {
			every_playable_country = {
				limit = { is_galactic_community_member = yes NOT = { is_same_value = event_target:f93_ralis_liberator } }
				add_opinion_modifier = {
					modifier = f93_ralis_true_liberator
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					every_system_within_border = {
						remove_claims = {
							who = prevprev
							num_of_claims = 100
						}
					}
				}
			}	
			if = {
				limit = {
					OR = {
						has_federations_dlc = yes
						has_nemesis = yes
					}
					NOT = { has_global_flag = galactic_council_formed }
					has_galactic_emperor = no
				}
				pass_resolution_no_cooldown = resolution_galacticreforms_form_council
				if = {
					limit = { is_part_of_galactic_council = no }
					increase_council_size = yes
				}
				add_permanent_councillor = yes
			}
			else = {
				add_resource = {
					unity = 10000
					alloys = 15000
				}
			}
			add_resource = {
				unity = 10000
			}
			add_modifier = {
				modifier = f93_ralis_true_liberator
				multiplier = 1
			}
			
			if = {
				limit = { exists = event_target:f93_community_ralis_admin_country }
				f93_final_handover_to_ralis_admin = yes
				event_target:f93_community_ralis_admin_country = {
					every_system_within_border = {
						limit = {
							# has_star_flag = f93_ralis_took_it_from_someone
							NOT = { has_star_flag = f93_ralis_empire_cluster }
						}
						save_event_target_as = f93_return_system
						event_target:f93_ralis_liberator = {
							event_target:f93_return_system = {
								if = {
									limit = { has_star_flag = f93_ralis_took_it_from@prev }
									starbase = { set_owner = prevprev }
									every_system_colony = { set_owner = prevprev }
									remove_star_flag = f93_ralis_took_it_from_someone
								}
							}
						}
					}
				}
			}
		}
	}
}

#the last handover
country_event = {
	id = f93_ralis_crisis_event.1206
	title = f93_ralis_crisis_event.1206.name
	desc = f93_ralis_crisis_event.1206.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1206 } }
	immediate = {
		#log_error = "Crisis event 1206 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1206 }
		set_country_flag = has_seen_f93_ralis_crisis_event1206
	}
	option = {
		name = OK
	}	
}

#a Cold Coup, only seen my liberatore once
country_event = {
	id = f93_ralis_crisis_event.1207
	title = f93_ralis_crisis_event.1207.name
	desc = f93_ralis_crisis_event.1207.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_country_flag = f93_conquered_and_kept_ralis
	}
	immediate = {
		#log_error = "Crisis event 1207 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1207 }
	}
	option = {
		name = f93_ralis_crisis_event.1207.a
		country_event = { id = f93_ralis_crisis_event.1209 }
		if = {
			limit = {
				exists = event_target:f93_community_ralis_admin_country
			}
			event_target:f93_community_ralis_admin_country = {
				every_system_within_border = {
					limit = { has_star_flag = f93_ralis_empire_cluster }
					starbase = {
						set_owner = event_target:f93_ralis_liberator
					}
				}
			}
		}
	}
}

#Ralis Admin collapses
country_event = {
	id = f93_ralis_crisis_event.1208
	title = f93_ralis_crisis_event.1208.name
	desc = f93_ralis_crisis_event.1208.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1208 } }
	immediate = {
		#log_error = "Crisis event 1208 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1208 }
		set_country_flag = has_seen_f93_ralis_crisis_event1208
	}
	option = {
		name = OK
		tooltip = {
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = event_target:f93_ralis_liberator }
		}
	}
}

#a quiet verdicts
country_event = {
	id = f93_ralis_crisis_event.1209
	title = f93_ralis_crisis_event.1209.name
	desc = f93_ralis_crisis_event.1209.desc
	picture = GFX_evt_alien_segregation
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#log_error = "Crisis event 1209 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1209 }
	}
	option = {
		name = f93_ralis_crisis_event.1209.a
		every_playable_country = {
			limit = { is_galactic_community_member = yes }
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = root }
		}
		remove_from_galactic_community = yes
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1300
	hide_window = yes
	is_triggered_only = yes
	# trigger = {
	# 	has_global_flag = f93_ralis_crisis_event1300_active
	# 	exists = event_target:f93_community_ralis_admin_country
	# 	is_same_value = event_target:f93_community_ralis_admin_country 
	# }
	immediate = {
		#log_error = "Crisis event 1300 on [GetDate] by [Root.GetName]"
		# f93_ralis_admin_returns_a_system = yes
		random_system_within_border = {
			limit = {
				has_star_flag = f93_ralis_took_it_from_someone
				NOT = { has_star_flag = f93_ralis_empire_cluster }
			}
			save_event_target_as = f93_return_system
			random_list = {
				50 = {
					random_playable_country = {
						limit = { prev = { has_star_flag = f93_ralis_took_it_from@event_target:system_receiver } }
						save_event_target_as = system_receiver
						event_target:f93_return_system = {
							starbase = { set_owner = event_target:system_receiver }
							every_system_colony = {
								set_owner = event_target:system_receiver
								planet_event = { id = f93_ralis_crisis_event.1302 days = 1 }
							}
							remove_star_flag = f93_ralis_took_it_from_someone
						}
					}
				}
				10 = {
					event_target:f93_return_system = {
						starbase = { set_owner = event_target:f93_ralis_liberator }
						every_system_colony = { set_owner = event_target:f93_ralis_liberator planet_event = { id = f93_ralis_crisis_event.1302 days = 1 } }
						remove_star_flag = f93_ralis_took_it_from_someone
					}
				}
				40 = {
					modifier = {
						factor = 0
						NOT = { any_system_planet = { is_colony = yes } }
					}
					create_country = {
						name = random
						type = default
						origin = origin_default
						ethos = random
						authority = random
						civics = random
						flag = random
						name_list = random
						ignore_initial_colony_error = yes
						effect = {
							add_resource = {
								minerals = 50
								energy = 150
								alloys = 10
								consumer_goods = 10
								food = 10
								trade = 450
								mult = trigger:years_passed
							}
							copy_techs_from = { target = event_target:f93_ralis_liberator }
							add_to_galactic_community = yes
						}
					}
					every_system_colony = {
						set_owner = last_created_country
						f93_create_galcom_admin_planet = yes
					}
					starbase = { set_owner = last_created_country }
					every_neighbor_system = {
						limit = {
							has_star_flag = f93_ralis_took_it_from_someone
						}
						starbase = { set_owner = last_created_country }
						every_system_colony = { set_owner = last_created_country }
						remove_star_flag = f93_ralis_took_it_from_someone
					}
					every_country = {
						limit = { is_galactic_community_member = yes }
						establish_communications_no_message = last_created_country
					}
				}
			}
			remove_star_flag = f93_ralis_took_it_from_someone
			every_fleet_in_system = {
				limit = { owner = { is_same_value = event_target:f93_community_ralis_admin_country } }
				delete_fleet = this
			}
		}
		if = {
			limit = {
				any_system_within_border = {
					NOR = {
						has_star_flag = f93_ralis_took_it_from_someone
						has_star_flag = f93_ralis_empire_cluster
					}
				}
			}
			random_system_within_border = {
				limit = {
					NOR = {
						has_star_flag = f93_ralis_took_it_from_someone
						has_star_flag = f93_ralis_empire_cluster
					}
				}
				closest_system = {
					limit = {
						exists = space_owner
						space_owner = { is_galactic_community_member = yes }
					}
					space_owner = { save_event_target_as = f93_gets_this_system }
				}
				starbase = { set_owner = event_target:f93_gets_this_system }
			}
		}
		if = {
			limit = {
				count_system_within_border = {
					count = all
					limit = { has_star_flag = f93_ralis_empire_cluster }
				}
			}
			remove_global_flag = f93_ralis_crisis_event1300_active
		}
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1301
	title = f93_ralis_crisis_event.1301.name
	desc = f93_ralis_crisis_event.1301.desc
	picture = GFX_evt_f93_galactic_crossing_senate
	is_triggered_only = yes
	
	immediate = {
		#log_error = "Crisis event 1301 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1301 }
		random_country = {
			limit = { 
				has_country_flag = f93_community_ralis_admin_country
				NOT = { has_global_flag = f93_ralis_crisis_event1300_active }
			}
			save_global_event_target_as = f93_community_ralis_admin_country
		}
	}
	option = {
		name = f93_ralis_crisis_event.1301.a
		
	}
	option = {
		name = f93_ralis_crisis_event.1301.b
	}
	after = {
		if = {
			limit = {
				NOT = { has_global_flag = f93_ralis_crisis_event1300_active }
			}
			set_global_flag = f93_ralis_crisis_event1300_active
			hidden_effect = {
				event_target:f93_community_ralis_admin_country = {
					#Balkanization of the ralis admin country
					every_system_within_border = {
						prev = { country_event = { id = f93_ralis_crisis_event.1300 days = 60 random = 270 } }
					}
					while = {
						count = 20
						country_event = { id = f93_ralis_crisis_event.1300 days = 1 random = 59 }
					}
					#end of the balkanization
					country_event = { id = f93_ralis_crisis_event.1303 days = 360 random = 30 }
				}
			}
			
		}
	}
}
#community admin system joins someone else
#systems united
planet_event = {
	id = f93_ralis_crisis_event.1302
	title = f93_ralis_crisis_event.1302.name
	desc = f93_ralis_crisis_event.1302.desc
	picture = GFX_evt_happy_reunion
	is_triggered_only = yes
	immediate = {
		#log_error = "Crisis event 1302 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1302 }
	}
	option = {
		name = f93_ralis_crisis_event.1302.a
	}
}

country_event = {
	id = f93_ralis_crisis_event.1303
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		exists = event_target:f93_community_ralis_admin_country
		NOT = { has_global_flag = f93_ralis_crisis_event1300_active }
	}
	immediate = {
		#log_error = "Crisis event 1303 on [GetDate] by [Root.GetName]"
		every_system_within_border = {
			system_event = { id = f93_ralis_crisis_event.1304 }
		}
		every_country = {
			country_event = { id = f93_ralis_crisis_event.1401 days = 36 }
			country_event = { id = f93_ralis_crisis_event.1402 days = 36 }
			country_event = { id = f93_ralis_crisis_event.1403 days = 37 }
		}
	}
}
#cleaning up whatever is left
system_event = {
	id = f93_ralis_crisis_event.1304
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_star_flag = f93_ralis_empire_cluster }
	}
	immediate = {
		#log_error = "Crisis event 1304 on [GetDate] by [Root.GetName]"
		closest_system = {
			limit = {
				exists = space_owner
				space_owner = {
					NOT = { is_same_value = event_target:f93_community_ralis_admin_country }
					is_galactic_community_member = yes
				}
			}
			space_owner = { save_event_target_as = system_receiver }
		}
		starbase = { set_owner = event_target:system_receiver }
		every_system_colony = { set_owner = event_target:system_receiver }
	}
}

#the zro must flow
country_event = {
	id = f93_ralis_crisis_event.1401
	title = f93_ralis_crisis_event.1401.name
	desc = f93_ralis_crisis_event.1401.desc
	picture = GFX_evt_f93_galactic_crossing_party
	is_triggered_only = yes

	trigger = {
		#combined these two means the treaty never happened and ralis was kept by liberator
		has_global_flag = f93_community_claim_never_made
		has_global_flag = f93_community_ignored
		NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1401 }
	}
	immediate = {
		#log_error = "Crisis event 1401 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1401 }
		set_country_flag = has_seen_f93_ralis_crisis_event1401
		set_global_flag = f93_gal_cartel_cant_happen
		country_event = { id = f93_ralis_crisis_event.1503 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.a
		allow = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } }
		event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 8 } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.b
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.c
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
	}
}
#The Republic of Ralis
country_event = {
	id = f93_ralis_crisis_event.1402
	title = f93_ralis_crisis_event.1402.name
	desc = f93_ralis_crisis_event.1402.desc
	picture = GFX_evt_f93_galactic_crossing_public_announcment
	is_triggered_only = yes
	trigger = {
		event_target:f93_community_ralis_admin_country = {
			any_system_within_border = { is_same_value = event_target:f93_ralis_system }
		}
		NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1402 }
	}

	immediate = {
		#log_error = "Crisis event 1402 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1402 }
		set_country_flag = has_seen_f93_ralis_crisis_event1402
		country_event = { id = f93_ralis_crisis_event.1501 days = 960 }
		set_global_flag = f93_gal_cartel_cant_happen
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event1402_happened } }
			event_target:f93_community_ralis_admin_country = {
				set_country_type = default
				set_origin = origin_default
				change_country_flag = {
					icon = { category = "union_state" file = ralis_banner.dds }
					background = { category = "backgrounds" file = "00_solid.dds" }
					colors = {"blue" "dark_blue" "null" "null" }
				}
				remove_country_flag = f93_community_ralis_admin_country
				clear_ethos = yes
				country_add_ethic = ethic_materialist
				country_add_ethic = ethic_egalitarian
				country_add_ethic = ethic_xenophile
				set_name = ralis_republic_NAME
				save_global_event_target_as = f93_republic_of_ralis
				copy_techs_from = { target = event_target:f93_ralis_liberator }
				add_opinion_modifier = {
					modifier = f93_legendary_friendship
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					add_opinion_modifier = {
						modifier = f93_legendary_friendship
						who = event_target:f93_community_ralis_admin_country
					}
				}
			}
			event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 10 } }
			set_global_flag = f93_ralis_crisis_event1402_happened
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.1402.a
		tooltip = {
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
				clear_global_event_target = f93_community_ralis_admin_country
			}
		}
	}
}
#A Galactic Cartel
country_event = {
	id = f93_ralis_crisis_event.1403
	title = f93_ralis_crisis_event.1403.name
	desc = f93_ralis_crisis_event.1403.desc
	picture = GFX_evt_f93_galactic_crossing_cat_walk
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = f93_gal_cartel_cant_happen
			has_country_flag = has_seen_f93_ralis_crisis_event1403
		}
	}
	immediate = {
		#log_error = "Crisis event 1403 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1403 }
		set_country_flag = has_seen_f93_ralis_crisis_event1403
		set_global_flag = f93_galactic_cartel_ralis_happened
		country_event = { id = f93_ralis_crisis_event.1502 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1403.a
		trigger = { NOT = { any_owned_planet = { is_same_value = event_target:f93_ralis_planet } } }
		tooltip = {
			event_target:f93_ralis_planet = {
				f93_add_zro_cartel = yes
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.1403.b
		trigger = { any_owned_planet = { is_same_value = event_target:f93_ralis_planet } }
		event_target:f93_ralis_planet = {
			f93_add_zro_cartel = yes
		}
	}
}
#The Zro Syphon
country_event = {
	id = f93_ralis_crisis_event.1404
	hide_window = yes
	mean_time_to_happen = 150

	trigger = {
		any_owned_planet = {
			is_colony = yes f93_has_zro_cartel = yes
		}
	}

	immediate = {
		#log_error = "Crisis event 1404 on [GetDate] by [Root.GetName]"
		every_planet_within_border = {
			limit = { is_colony = no f93_has_zro_cartel = yes }
			remove_modifier = f93_zro_cartel
			remove_modifier = f93_zro_drone_cartel
		}
		random_owned_planet = {
			limit = { f93_has_zro_cartel = yes }
			solar_system = {
				closest_system = {
					use_bypasses = yes
					limit = {
						exists = owner
						exists = starbase
						starbase = {
							owner = {
								is_country_type = default
								f93_is_zro_cartel_lord = no
							}
						}
						any_system_planet = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
						f93_add_zro_cartel = yes
					}
				}
			}
		}
		set_variable = { which = f93_zro_income value = 0 }
		export_resource_income_to_variable = {
			resource = sr_zro
			variable = f93_zro_income
		}
		divide_variable = { which = f93_zro_income value = trigger:num_owned_planets }

		every_owned_planet = {
			limit = { f93_has_zro_cartel = yes exists = owner }
			owner = {
				add_resource = {
					sr_zro = -2
					mult = f93_zro_income
				}
			}
			event_target:f93_ralis_planet = {
				owner = {
					set_variable = { which = f93_zro_income value = root.f93_zro_income }
					add_resource = {
						sr_zro = 2
						mult = f93_zro_income
					}
				}
			}
		}
	}
}

#Beyond the Lighthouse
country_event = {
	id = f93_ralis_crisis_event.1501
	title = f93_ralis_crisis_event.1501.name
	desc = f93_ralis_crisis_event.1501.desc
	picture = GFX_evt_f93_galactic_crossing_storm_world
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#log_error = "Crisis event 1501 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1501 }
		country_event = { id = f93_galactic_crossing.10 }
		country_event = { id = f93_oe_event.11 days = 1800 }
	}
	option = {
		name = f93_ralis_crisis_event.1501.a
	}
}
#Into the Shadows
country_event = {
	id = f93_ralis_crisis_event.1502
	title = f93_ralis_crisis_event.1502.name
	desc = f93_ralis_crisis_event.1502.desc
	picture = GFX_evt_shroud_tunnel
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#log_error = "Crisis event 1502 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1502 }
		country_event = { id = f93_galactic_crossing.10 }
		country_event = { id = f93_oe_event.13 days = 1800 }
	}
	option = {
		name = f93_ralis_crisis_event.1502.a
	}
	option = {
		name = f93_ralis_crisis_event.1502.b
	}
}
#The Eyes that cannot blink.
country_event = {
	id = f93_ralis_crisis_event.1503
	title = f93_ralis_crisis_event.1503.name
	desc = f93_ralis_crisis_event.1503.desc
	picture = GFX_evt_f93_galactic_crossing_dark_eyes
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#log_error = "Crisis event 1503 on [GetDate] by [Root.GetName]"
		#observer_event = { id = f93_ralis_observer_event.1503 }
		country_event = { id = f93_galactic_crossing.10 }
		country_event = { id = f93_oe_event.12 days = 1800 }
	}
	option = {
		name = f93_ralis_crisis_event.1503.a
	}
}