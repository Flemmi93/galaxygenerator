namespace = f93_ralis_crisis_event

# Ralis Crisis 
#################################
# numbers						#
# first 2 digits are level		#
# 2nd two digits are variance	#
#################################

#Anomalies along the Galactic Crossing
country_event = {
	id = f93_ralis_crisis_event.0001
	title = f93_ralis_crisis_event.0001.name
	desc = f93_ralis_crisis_event.0001.desc
	picture = GFX_evt_ongoing_disaster
	show_sound = event_whispering
	fire_only_once = yes
	
	# mean_time_to_happen = 1
	is_triggered_only = yes

	trigger = {

	}

	immediate = {
		if = {
			limit = { has_global_flag = f82_button_1_1_off }
			set_global_flag = f93_shroud_gate_active
			event_target:f93_ralis_system = {
				random_system = {
					limit = { NOT = { exists = owner } f93_system_winthin_20_steps_of_galcro = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
					prev = {
						f93_place_shroud_gate_node = yes
					}
					f93_place_shroud_gate_nexus = yes
				}
				random_system = {
					limit = { NOT = { exists = owner } f93_system_winthin_20_steps_of_galcro = yes NOT = { has_star_flag = f93_got_shroud_nexus_node } }
					f93_place_shroud_gate_nexus = yes
				}
			}
		}
		else = {
			#observer_event = { id = f93_ralis_observer_event.0001 }
			set_variable = { which = stars_destroyed value = 0 }
			save_global_event_target_as = crisis_country
			set_global_flag = f93_ralis_awoken
			# set_country_type = default
			every_playable_country = {
				country_event = {
					id = f93_ralis_crisis_event.0101
					days = 120
				}
			}
			every_playable_country = {
				limit = { NOR = { is_same_value = root has_country_flag = ralis_country_flag } }
				country_event = { id = f93_ralis_crisis_event.0002 }
			}
			event_target:f93_ralis_country = {
				add_resource = {
					sr_dark_matter = 5
					alloys = 2
					minerals = 0.5
					energy = 3
					food = 0.01
					consumer_goods = 0.25
					unity = 0.1
					mult = 30000
				}
				add_tradition = tr_supremacy_adopt
				add_tradition = tr_supremacy_fleet_logistical_corps
				add_tradition = tr_supremacy_master_shipwrights
				add_tradition = tr_supremacy_war_games
				add_tradition = tr_supremacy_overwhelming_force
				add_tradition = tr_supremacy_great_game
				add_tradition = tr_supremacy_finish
				add_ascension_perk = ap_become_the_crisis #only works on 4.0 and up
				set_ai_personality = became_the_crisis_f93_shrouded_region_crisis
				create_fleet = {
					effect = {
						set_owner = event_target:f93_ralis_country
						set_location = event_target:f93_ralis_country.capital_scope
						create_ship = {
							name = random
							random_existing_design = science
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = event_target:f93_ralis_country
						set_location = event_target:f93_ralis_country.capital_scope
						create_ship = {
							name = random
							random_existing_design = science
						}
					}
				}
				if = {
					limit = { NOT = { has_modifier = f93_ralis_country_buff } }
					add_modifier = {
						modifier = f93_ralis_country_buff
						multiplier = 1
						days = -1
					}
				}
				
				every_playable_country =  {
					event_target:f93_ralis_system = {
						remove_claims = { who = prev num_of_claims = 100 }
					}
				
				}
				event_target:f93_ralis_system = {
					random_system_megastructure = {
						limit = { is_megastructure_type = crisis_sphere_ruined }
						remove_megastructure = this
					}
					set_global_flag = f93_shroud_gate_active
					random_system = {
						limit = { NOR = { exists = owner has_star_flag = f93_got_shroud_nexus_node any_neighbor_system = { exists = space_owner space_owner = { is_country_type = fallen_empire } } } f93_system_has_ancient_relay = yes }
						prev = {
							f93_place_shroud_gate_node = yes
						}
						f93_place_shroud_gate_nexus = yes
					}
					random_system = {
						limit = { NOR = { exists = owner has_star_flag = f93_got_shroud_nexus_node any_neighbor_system = { exists = space_owner space_owner = { is_country_type = fallen_empire } } } f93_system_has_ancient_relay = yes }
						f93_place_shroud_gate_nexus = yes
					}
				}
			}
		}
	}
	option = {
		name = WORRYING
	}
}
#Anomalies along the Galactic Crossing
country_event = {
	id = f93_ralis_crisis_event.0002
	title = f93_ralis_crisis_event.0001.name
	desc = f93_ralis_crisis_event.0001.desc
	picture = GFX_evt_ongoing_disaster
	show_sound = event_whispering
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0002 }
	}
	option = {
		name = WORRYING
	}
}

#Monthly Difficulty Adjustment Event
country_event = {
	id = f93_ralis_crisis_event.0003
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
	}
	immediate = {
		#easy
		if = {
			limit = {
				has_global_flag = f82_button_3_1_on
			}
			remove_modifier = fe_ship_cost_modifier
			remove_modifier = f93_artificial_ship_naval_cap_usage_mult
			remove_modifier = f93_ship_fire_rate_mult
			remove_modifier = f93_pre_midgame_stabalisation
			add_modifier = {
				modifier = f93_ship_fire_rate_mult
				mult = -0.35
			}
			add_modifier = {
				modifier = f93_artificial_ship_naval_cap_usage_mult
				mult = 1.25
			}
			if = {
				limit = { mid_game_years_passed < 0 }
				add_modifier = {
					modifier = f93_pre_midgame_stabalisation
					mult = 250	
				}
			}
			if = {
				limit = { is_country_type = f93_shrouded_region_crisis used_naval_capacity_percent < 0.75 NOT = { has_country_flag = f93_recent_reinforcments } }
				set_timed_country_flag = {
					flag = f93_recent_reinforcments
					days = 720
				}
				f93_create_ralis_fleet = yes
			}
		}

		#default
		if = {
			limit = {
				has_global_flag = f82_button_3_2_on
			}
			remove_modifier = fe_ship_cost_modifier
			remove_modifier = f93_artificial_ship_naval_cap_usage_mult
			remove_modifier = f93_ship_fire_rate_mult
			remove_modifier = f93_pre_midgame_stabalisation
			add_modifier = {
				modifier = f93_ship_fire_rate_mult
				mult = -0.2
			}
			if = {
				limit = { mid_game_years_passed < 1 NOT = { any_owned_fleet = { has_fleet_flag = f93_fleet_attacking } } }
				add_modifier = {
					modifier = f93_pre_midgame_stabalisation
					mult = 300
				}
			}
			if = {
				limit = { any_owned_fleet = { fleet_power < 2000 has_fleet_flag = recently_made } }
				every_owned_fleet = {
					limit = { fleet_power < 2000 has_fleet_flag = recently_made }
					if = {
						limit = { exists = leader }
						leader = { unassign_leader = this }
					}
					destroy_fleet = this
				}
			}
			if = {
				limit = {
					is_country_type = f93_shrouded_region_crisis used_naval_capacity_percent < 0.95 NOT = { has_country_flag = f93_recent_reinforcments }
				}
				set_timed_country_flag = {
					flag = f93_recent_reinforcments
					days = 480
				}
				f93_create_ralis_fleet = yes
			}
			
			random_owned_starbase = {
				if = {
					limit = { used_defense_platform_capacity_percent < 1 }
					spawn_free_defense_platform = yes
				}
			}
		}

		#hard
		if = {
			limit = {
				has_global_flag = f82_button_3_3_on
			}
			remove_modifier = fe_ship_cost_modifier
			remove_modifier = f93_artificial_ship_naval_cap_usage_mult
			remove_modifier = f93_ship_fire_rate_mult
			remove_modifier = f93_pre_midgame_stabalisation
			add_modifier = {
				modifier = fe_ship_cost_modifier
				multiplier = 1
			}
			add_modifier = {
				modifier = f93_artificial_ship_naval_cap_usage_mult
				mult = 0.85
			}
			if = {
				limit = { mid_game_years_passed < 5 }
				add_modifier = {
					modifier = f93_pre_midgame_stabalisation
					mult = 350
				}
			}
			if = {
				limit = { any_owned_fleet = { fleet_power < 5000 has_fleet_flag = recently_made } }
				every_owned_fleet = {
					limit = { fleet_power < 5000 has_fleet_flag = recently_made }
					if = {
						limit = { exists = leader }
						leader = { unassign_leader = this }
					}
					destroy_fleet = this
				}
			}
			if = {
				limit = {
					is_country_type = f93_shrouded_region_crisis
					used_naval_capacity_percent < 0.95
					NOT = { has_country_flag = f93_recent_reinforcments }
				}
				set_timed_country_flag = {
					flag = f93_recent_reinforcments
					days = 360
				}
			f93_create_ralis_fleet = yes
			}
		}
	}
}

country_event = {
	id = f93_ralis_crisis_event.0004
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:f93_ralis_country = { set_faction_hostility = { target = root set_hostile = no set_neutral = yes set_friendly = no } }
	}
}

# This = starbase being disabled (not ship!)
# From = fleet that disabled the starbase
starbase_event = {
	id = f93_ralis_crisis_event.0005
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		or = {
			from = { owner = { is_same_value = event_target:f93_ralis_country } }
			owner = { is_same_value = event_target:f93_ralis_country }
		}
		# NOT = { has_fleet_flag = f93_recently_conquered }
	}
	immediate = {
		if = {
			limit = { owner = { is_same_value = event_target:f93_ralis_country } }
			set_owner = from.owner
		}
		else = {
			set_owner = event_target:f93_ralis_country
		}
		# set_timed_fleet_flag = {
		# 	flag = f93_recently_conquered
		# 	days = 30
		# }
	}
}

country_event = {
	id = f93_ralis_crisis_event.0006
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_ralis_country
		is_same_value = event_target:f93_ralis_country
		has_country_flag = f93_ralis_crisis_event0006active
		NOT = { has_country_flag = f93_recently_advanced_crisis }
	}
	immediate = {
		set_timed_country_flag = {
			flag = f93_recently_advanced_crisis
			days = 90
		}
		if = {
			limit = { has_special_project = CRISIS_SPECIAL_PROJECT_4 OR = { has_global_flag = f93_community_claim_made has_global_flag = f93_community_claim_never_made } }
			complete_special_project = { type =CRISIS_SPECIAL_PROJECT_4 }
			remove_country_flag = f93_ralis_crisis_event0006active
		}
		if = {
			limit = { has_special_project = CRISIS_SPECIAL_PROJECT_3 }
			complete_special_project = { type =CRISIS_SPECIAL_PROJECT_3 }
		}
		if = {
			limit = { has_special_project = CRISIS_SPECIAL_PROJECT_2 }
			complete_special_project = { type =CRISIS_SPECIAL_PROJECT_2 }
		}
		else = {
			limit = { has_special_project = CRISIS_SPECIAL_PROJECT_1 }
			complete_special_project = { type =CRISIS_SPECIAL_PROJECT_1 }
		}
	}
}
#A galaxy holds its breath
country_event = {
	id = f93_ralis_crisis_event.0101
	title = f93_ralis_crisis_event.0101.name
	desc = f93_ralis_crisis_event.0101.desc
	picture = GFX_evt_supernova
	show_sound = event_screams
	
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0101 }
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event0101_happened } }
			set_global_flag = f93_ralis_crisis_event0101_happened
			country_event = { id = f93_ralis_crisis_event.0102 }
		}
	}
	option = {
		name = f93_ralis_crisis_event.0101.a
		country_event = { id = f93_ralis_crisis_event.0201 days = 30 }
	}
}

country_event = {
	id = f93_ralis_crisis_event.0102
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		every_system = {
			limit = {
				any_neighbor_system = { any_neighbor_system = { f93_system_has_ancient_relay = yes } }
				NOR = {
					AND = {
						exists = space_owner
						space_owner = {
							OR = {
								is_country_type = fallen_empire
								is_country_type = dormant_marauders
							}
						}
					}
					AND = {
						exists = space_owner
						space_owner = {
							OR = {
								is_ai = no
								NOT = { has_global_flag = f82_button_1_2_on }
							}
						}
					}
				}
			}
			random_list = {
				45 = {
					system_event = { id = f93_ralis_crisis_event.0103 days = 2 random = 2 }
				}
				100 = {}
			}
		}
	}
}

#our system destroy event, much narrower
system_event = {
	id = f93_ralis_crisis_event.0103
	hide_window = yes
	is_triggered_only = yes
	trigger = { f93_should_not_be_destroyed = no any_neighbor_system = { exists = space_owner space_owner = { is_country_type = fallen_empire } } }
	immediate = {
		# set_name = "DESTROYED"
		if = {
			limit = { exists = space_owner space_owner = { is_country_type = default } }
			every_system_colony = {
				every_owned_pop_group = {	
					limit = { is_valid_refugee_pop = yes }
					save_event_target_as = refugee_pop #Must be saved for refugee_pop_effect to work
					refugee_pop_effect = yes
				}
			}
		}
		# destroy_star_system = yes
		set_star_flag = star_cracked
		set_star_class = sc_black_hole
		every_system_ambient_object = {
			destroy_ambient_object = this
		}
		every_system_planet = {
			limit = { is_star = yes }
			create_ambient_object = {
				type = "star_explosion"
				play_animation_once = yes
				location = this
			}
			last_created_ambient_object = {
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
			change_pc = pc_black_hole
		}
		every_system_planet = {
			limit = {
				is_star = no
				is_asteroid = no
				NOR = {
					is_planet_class = pc_shattered
					is_planet_class = pc_shattered_2
					is_planet_class = pc_shielded
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_seam_damaged
				}
			}
			if = {
				limit = { is_planet_class = pc_habitat } # uncolonized
				spawn_habitat_cracker_effect = yes
			}
			if = {
				limit = { is_colony = yes }
				if = {
					limit = {
						exists = orbital_defence
					}
					destroy_fleet = orbital_defence
				}
				remove_all_buildings = yes
				destroy_colony = yes
				if = {
					limit = { is_planet_class = pc_habitat }
					spawn_habitat_cracker_effect = yes
				}
				else_if = {
					limit = { is_ringworld = yes }
					spawn_ringworld_cracker_effect = yes
					change_pc = pc_ringworld_habitable_damaged
				}
				else = {
					change_pc = pc_shattered
				}
			}
			else_if = {
				limit = { is_ringworld = yes }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_habitable_damaged
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_tech }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_tech_damaged
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_seam }
				spawn_ringworld_cracker_effect = yes
				change_pc = pc_ringworld_seam_damaged
			}
			else = {
				change_pc = pc_shattered
			}
		}
		every_system_planet = {
			limit = {
				exists = orbital_station
			}
			orbital_station = { dismantle = yes }
		}
		every_system_planet = {
			clear_deposits = yes
			clear_planet_modifiers = yes
			prevent_anomaly = yes
		}
		every_system_planet = {
			limit = { is_asteroid = yes }
			clear_deposits = yes
		}
		every_fleet_in_system = {
			limit = {
				NOR = {
					is_same_value = from
					# except Extradimensionals
					AND = {
						exists = owner
						owner = {
							OR = {
								is_country_type = portal_holder
								is_country_type = extradimensional
								is_country_type = extradimensional_2
								is_country_type = extradimensional_3
							}
						}
					}
					# except biggest monsters
					any_owned_ship = {
						OR = {
							is_ship_size = behemoth_04
							is_ship_size = voidspawn_boss
						}
					}
				}
			}
			destroy_fleet = this
		}
		every_system_megastructure = {
			set_ruined_megastructure = yes
		}
		star = {
			create_ambient_object = {
				type = "destroyed_system"
				location = this
			}
			last_created_ambient_object = {
				set_ambient_object_flag = destroyed_system_effect
				set_location = {
					target = prev
					distance = 0
					angle = random
				}
			}
		}
		remove_system_terraforming_candidates = yes

		every_system_planet = { reroll_deposits = yes }
		event_target:f93_ralis_country = {
			change_variable = { which = stars_destroyed value = 1 }
		}
		closest_system = {
			limit = { exists = space_owner space_owner = { is_country_type = default } }
			set_star_flag = f93_ralis_crisis_event_got_hit_flag
		}
		random_country = {
				limit = {
					is_ai = yes
					is_country_type = default
					any_system_within_border = { has_star_flag = f93_ralis_crisis_event_got_hit_flag }
				}
				save_global_event_target_as = f93_to_be_killed_by_ralis
			}
			if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
						f93_is_close_to_highway = yes
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_ai = yes
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_country_type = default
						f93_is_close_to_highway = yes
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
			else_if = {
				limit = { NOT = { exists = event_target:f93_to_be_killed_by_ralis } }
				random_country = {
					limit = {
						is_country_type = default
					}
				save_global_event_target_as = f93_to_be_killed_by_ralis
				}
			}
	}
}

#Senate Report
country_event = {
	id = f93_ralis_crisis_event.0201
	title = f93_ralis_crisis_event.0201.name
	desc = f93_ralis_crisis_event.0201.desc
	picture = GFX_evt_astral_rift_ancient_battlegrounds
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0201 }
		
		if = {
			limit = {
				exists = event_target:f93_to_be_killed_by_ralis
				NOT = { has_global_flag = f93_ralis_crisis_event0201_happened }
			}
			set_global_flag = f93_ralis_crisis_event0201_happened
			event_target:f93_to_be_killed_by_ralis = {
				every_system_within_border = {
					limit = { NOT = { f93_should_not_be_destroyed = yes } }
					random_list = {
						2 = {
							modifier = {
								factor = 0.25
								NOT = { any_neighbor_system = { f93_system_has_ancient_relay = yes } }
							}
							destroy_star_system = yes
							every_system_planet = { reroll_deposits = yes }
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { any_system_planet = { is_colony = yes } }
							}
							create_country = {
								name = random
								type = primitive
								origin = origin_default
								ethos = random
								authority = random
								civics = random
								flag = random
								name_list = random
								ignore_initial_colony_error = yes
								effect = {
									set_country_flag = early_space_age
									set_pre_ftl_age = early_space_age
									set_awareness = 100
									add_resource = {
										minerals = 50
										energy = 150
										alloys = 10
										consumer_goods = 10
										food = 10
										trade = 450
										mult = trigger:years_passed
									}
								}
							}
							starbase = { set_owner = last_created_country }
							every_neighbor_system = {
								limit = {
									has_star_flag = f93_ralis_took_it_from_someone
								}
								starbase = { set_owner = last_created_country }
								every_system_colony = { set_owner = last_created_country }
								remove_star_flag = f93_ralis_took_it_from_someone
							}
							every_country = {
								limit = { is_galactic_community_member = yes }
								establish_communications_no_message = last_created_country
							}
						}
					}
					
				}
				destroy_country = yes
			}
			event_target:f93_ralis_country = {
				if = {
					limit = { is_ai = yes }
					add_resource = {
						menace = 10000
					}
					set_country_flag = f93_ralis_crisis_event0006active
					set_timed_country_flag = {
						flag = f93_recently_advanced_crisis
						days = 90
					}
				}
				capital_scope = { set_name = ralis_planet_NAME }
				every_playable_country = {
					establish_contact = { who = prev location = prev.capital_scope }
				}
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.0201.a
		country_event = { id = f93_ralis_crisis_event.0301 days = 180 }
	}
}

# country_event = {
# 	id = f93_ralis_crisis_event.0202
# 	hide_window = yes
# 	fire_only_once = yes
# 	is_triggered_only = yes

# 	immediate = {
# 		random_system = {
# 			limit = { has_star_flag = f93_ralis_empire_cluster NOT = { is_same_value = event_target:f93_ralis_system } }
# 			spawn_megastructure = {
# 				type = think_tank_4
# 				owner = root
# 				planet = star
# 				graphical_culture = root
# 			}
# 			save_global_event_target_as = f93_ralis_think_tank_system
# 			add_hyperlane = { from = this to = event_target:f93_ralis_system }
# 		}
# 	}
# }

#Receding of the Abyss
country_event = {
	id = f93_ralis_crisis_event.0301
	title = f93_ralis_crisis_event.0301.name
	desc = f93_ralis_crisis_event.0301.desc
	picture = GFX_evt_treasure_trove_pirate_fleet
	
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0301 }
		event_target:f93_ralis_country = {
			establish_contact = { who = root }
			set_country_flag = f93_ralis_arms_race_active
		}
	}
	option = {
		name = f93_ralis_crisis_event.0301.a
	}
	option = {
		name = f93_ralis_crisis_event.0301.b
	}

	after = {

	}
}
country_event = {
	id = f93_ralis_crisis_event.0400
	hide_window = yes
	fire_only_once = yes
	# mean_time_to_happen = 1
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		exists = event_target:f93_ralis_country
		event_target:f93_ralis_country = {
			OR = {
				has_crisis_level = crisis_level_2
				has_crisis_level = crisis_level_3
				has_crisis_level = crisis_level_4
				has_crisis_level = crisis_level_5
			}
		}
	}
	immediate = {
		every_playable_country = {
			country_event = { id = f93_ralis_crisis_event.0401 days = 360 }
		}
	}
}
#Secrets of Ralis
country_event = {
	id = f93_ralis_crisis_event.0401
	title = f93_ralis_crisis_event.0401.name
	desc = f93_ralis_crisis_event.0401.desc
	picture = GFX_evt_cosmic_storms_the_storm_speaks
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0401 }
	}
	option = {
		name = f93_ralis_crisis_event.0401.a
		country_event = { id = f93_ralis_crisis_event.0501 days = 90 }
	}
	after = {}
}

#The War Plan Debate
country_event = {
	id = f93_ralis_crisis_event.0501
	title = f93_ralis_crisis_event.0501.name
	desc = f93_ralis_crisis_event.0501.desc
	picture = GFX_evt_civil_action
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes

	trigger = {
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0501 }
		event_target:f93_ralis_country = {
			add_modifier = {
				modifier = f93_ralis_science_stop
				multiplier = 1
			}
		}
		set_global_flag = f93_activate_ralis_resolution_1
	}
	option = {
		name = f93_ralis_crisis_event.0501.a
		custom_tooltip = f93_ralis_crisis_event.0501.a_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_a
		}
	}
	option = {
		name = f93_ralis_crisis_event.0501.b
		custom_tooltip = f93_ralis_crisis_event.0501.b_desc
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_event_5_vote_b
		}
	}
	after = {
		every_playable_country = {
			establish_communications = event_target:f93_ralis_country
		}
	}
}


country_event = {
	id = f93_ralis_crisis_event.0601
	title = f93_ralis_crisis_event.0601.name
	desc = f93_ralis_crisis_event.0601.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0601 }
		event_target:f93_ralis_country = {
			remove_modifier = f93_ralis_science_stop
			add_modifier = {
				modifier = f93_ralis_science_stop
				multiplier = -1
			}
		}
		every_playable_country = {
			limit = { NOT = { has_country_flag = ralis_country_flag } }
			every_system_within_border = {
				set_star_flag = f93_ralis_took_it_from@prev
			}
		}
	}
	option = {
		allow = {
			OR = {
				is_egalitarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophile = yes
				is_megacorp = yes
				is_gestalt = yes
			}
		}
		name = f93_ralis_crisis_event.0601.a
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty
		}
	}
	option = {
		allow = {
			OR = {
				is_authoritarian = yes
				is_spiritualist = yes
				is_materialist = yes
				is_xenophobe = yes
				is_gestalt = yes
			}
		}
		name = f93_ralis_crisis_event.0601.b
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_accepted_treaty_unwillingly
		}
	}
	option = {
		trigger = { is_ai = yes }
		name = OK
	}
	option = {
		trigger = { is_ai = no }
		name = f93_ralis_crisis_event.0601.c
		hidden_effect = {
			set_country_flag = f93_ralis_crisis_rejected_treaty
		}
		remove_from_galactic_community = yes
	}
	
}
#The War plan treaty failed
country_event = {
	id = f93_ralis_crisis_event.0602
	title = f93_ralis_crisis_event.0602.name
	desc = f93_ralis_crisis_event.0602.desc
	picture = GFX_evt_two_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = yes
	}
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0602 }
		event_target:f93_ralis_country = {
			remove_modifier = f93_ralis_science_stop
			add_modifier = {
				modifier = f93_ralis_science_stop
				multiplier = -1
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.0602.a
	}
}
#The War plan treaty passed and tells everyone else about it
country_event = {
	id = f93_ralis_crisis_event.0603
	title = f93_ralis_crisis_event.0603.name
	desc = f93_ralis_crisis_event.0603.desc
	picture = GFX_evt_one_sided_deal
	# show_sound = event_mystic_reveal
	trigger = {
		is_galactic_community_member = no
	}
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0603 }
	}
	option = {
		name = OK
	}
}

#tracking what system was conquered from who by ralis
#this event gives ralis all colonies instantly, so ralis has less insentive to crack the star

# From = system
# FromFrom = country (new owner)
# This = country (previous owner)
country_event = {
	id = f93_ralis_crisis_event.0606
	hide_window = yes
	# mean_time_to_happen = 15
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:f93_ralis_country
		exists = space_owner
		is_same_value = event_target:f93_ralis_country
		space_owner = { is_same_value = event_target:f93_ralis_country }
		is_ai = yes
		event_target:f93_ralis_country = { is_at_war = yes }
	}
	immediate = {
		from = {
			random_list = {
				1 = {}
				2 = { 
					every_system_colony = { set_owner = event_target:f93_ralis_country }
				}
			}
		}
	}
}

# From = system
# FromFrom = country (new owner)
# This = country (previous owner)
country_event = {
	id = f93_ralis_crisis_event.0604
	hide_window = yes
	# mean_time_to_happen = 15
	is_triggered_only = yes
	
	trigger = {
		exists = event_target:f93_ralis_country
		exists = space_owner
		is_same_value = event_target:f93_ralis_country
		event_target:f93_ralis_country = { is_at_war = yes }
	}

	immediate = {
		if = {
			limit = { FROM = { NOT = { has_star_flag = f93_belonged_to_ralis } } }
			FROM = {
				set_star_flag = f93_ralis_took_it_from_someone
				#last owner could be someone else every time, this is intentional.
				set_star_flag = f93_ralis_took_it_from@root
			}
		}
	}
}


# country_event = {
# 	id = f93_ralis_crisis_event.0605
# 	hide_window = yes
# 	# mean_time_to_happen = 180
# 	is_triggered_only = yes
# 	fire_only_once = yes

# 	trigger = {
# 		NOT = { has_global_flag = f82_button_1_1_off }
# 		exists = event_target:f93_ralis_country
# 		event_target:f93_ralis_country = {
# 			is_level_5_player_crisis = yes
# 		}
# 	}

# 	immediate = {
# 		remove_modifier = f93_ralis_science_stop
# 		event_target:f93_ralis_think_tank_system = {
# 			every_system_megastructure = {
# 				limit = { is_megastructure_type = think_tank_4 }
# 				remove_megastructure = this
# 			}
# 			# spawn_megastructure = { type = think_tank_ruined }
# 		}
# 	}
# }

#anyone entering ralis system for the first time
ship_event = {
	id = f93_ralis_crisis_event.0701
	title = f93_ralis_crisis_event.0701.name
	desc = f93_ralis_crisis_event.0701.desc
	picture = GFX_evt_situation_the_seal
	# show_sound = event_mystic_reveal
	# mean_time_to_happen = 30
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		FROM = { is_same_value = event_target:f93_ralis_system }
		FromFrom = { NOT = { has_country_flag = f93_seen_ralis } }
	}
	immediate = { FromFrom = { set_country_flag = f93_seen_ralis } }
	option = {
		name = f93_ralis_crisis_event.0701.a
	}
}


# A fleet has entered a system | See also: on_fleet_auto_move_arrival
#A Fleet Entering Ralis during the War
# Scope = Fleet
# From = System
fleet_event = {
	id = f93_ralis_crisis_event.0702
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:f93_ralis_country
		from = { is_same_value = event_target:f93_ralis_system }
		exists = owner
		owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
		event_target:f93_ralis_country = { is_at_war = yes }
		event_target:f93_ralis_system = {
			any_fleet_in_system = {
				is_ship_class = shipclass_military
				owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
				NOT = { has_fleet_flag = f93_ralis_already_saw_this }
			}
		}
	}

	immediate = {
		set_timed_fleet_flag = {
			flag = f93_ralis_already_saw_this
			days = 30
		}
		#send home closest fleet
		event_target:f93_ralis_system = {
			closest_system = {
				limit = {
					any_fleet_in_system = {
						owner = { is_same_value = event_target:f93_ralis_country }
						is_ship_class = shipclass_military
					}
				}
				every_fleet_in_system = {
					limit = {
						owner = { is_same_value = event_target:f93_ralis_country }
						is_ship_class = shipclass_military
					}
					auto_move_to_planet = { target = event_target:f93_ralis_planet clear_auto_move_on_arrival = yes }
				}
			}
		}
		#send home strongest fleet
		event_target:f93_ralis_country = {
			ordered_controlled_fleet = {
				limit = {
					is_ship_class = shipclass_military
				}
				position = 0
				order_by = trigger:fleet_power
				auto_move_to_planet = { target = event_target:f93_ralis_planet clear_auto_move_on_arrival = yes }
			}
		}
	}
}


planet_event = {
	id = f93_ralis_crisis_event.0800
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = f82_button_1_1_off }
		is_same_value = event_target:f93_ralis_planet
		event_target:f93_ralis_planet = {
			is_colony = no
		}
	}

	immediate = {
		every_country = { country_event = { id = f93_ralis_crisis_event.0801 } }
	}
}
#ralis is destroyed
#nothing happens, the story ends here.
country_event = {
	id = f93_ralis_crisis_event.0801
	title = f93_ralis_crisis_event.0801.name
	desc = f93_ralis_crisis_event.0801.desc
	picture = GFX_evt_large_explosion
	# show_sound = event_mystic_reveal

	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0801 }
	}
	option = {
		name = f93_ralis_crisis_event.0801.a
	}
}

# This = Planet scope
# From = Country scope (new owner)
# FromFrom = Former Owner
#ralis is conquered
planet_event = {
	id = f93_ralis_crisis_event.0802
	title = f93_ralis_crisis_event.0802.name
	desc = f93_ralis_crisis_event.0802.desc
	picture = GFX_evt_burning_city
	# mean_time_to_happen = 1
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = f82_button_1_1_off
			has_global_flag = f93_ralis_defeated_for_good
		}
		is_same_value = event_target:f93_ralis_planet
		owner = { NOT = { is_same_value = event_target:f93_ralis_country } }
		NOT = { has_planet_flag = f93_recently_conquered }
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0802 }
		owner = { save_global_event_target_as = f93_ralis_liberator }
		event_target:f93_ralis_country = {
			set_name = ralis_remnant_NAME
		}
		set_timed_planet_flag = {
			flag = f93_recently_conquered
			days = 30
		}
		event_target:f93_ralis_planet = {
			planet_event = { id = f93_ralis_crisis_event.0803 days = 1 }
			planet_event = { id = f93_ralis_crisis_event.0803 days = 2 }
			planet_event = { id = f93_ralis_crisis_event.0803 days = 3 }
		}
	}
	option = {
		name = f93_ralis_crisis_event.0802.a 
		hidden_effect = {
			#treaty paths
			if = {
				limit = {
					event_target:f93_ralis_planet = { has_planet_flag = f93_galactic_community_claim }
				}
				#The Community's Mandate
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0901 days = 360 }
				}
				#The Community's Claim
				if = {
					limit = {
						event_target:f93_ralis_liberator = {
							is_galactic_community_member = yes
						}
					}
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0902 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_community_liberator
						}
					}
				}
				#The Community’s Request
				else = {
					event_target:f93_ralis_liberator = {
						country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
						hidden_effect = {
							set_country_flag = f93_communiy_claim_independent_liberator
						}
					}
				}
			}
			#no treaty path
			else = {
				#The Community’s Request
				event_target:f93_ralis_liberator = {
					country_event = { id = f93_ralis_crisis_event.0903 days = 60 }
				}
				#The Community’s Plea
				every_playable_country = {
					limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
					country_event = { id = f93_ralis_crisis_event.0905 days = 360 }
				}
			}
		}
	}
}

planet_event = {
	id = f93_ralis_crisis_event.0803
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_owner = event_target:f93_ralis_liberator
		starbase = { set_owner = event_target:f93_ralis_liberator }
	}
}
#Treaty Path
#The Community's Mandate, shown to all but the Ralis Liberator
country_event = {
	id = f93_ralis_crisis_event.0901
	title = f93_ralis_crisis_event.0901.name
	desc = f93_ralis_crisis_event.0901.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
		has_country_flag = f93_com_mandate_can_happen
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0901 }
	}
	#hand systems over to administration
	option = { 
		name = f93_ralis_crisis_event.0901.a
		trigger = { is_galactic_community_member = yes }
		f93_give_conquest_to_ralis_admin = yes
		every_playable_country = {
			limit = { is_galactic_community_member = yes }		
			add_opinion_modifier = { modifier = f93_kept_ralis_treaty who = root }
		}
		ai_chance = {
			factor = 50 # opposes the last option
		}
	}
	option = {
		trigger = { is_galactic_community_member = yes is_ai = no }
		name = f93_ralis_crisis_event.0901.d
		allow = { always = no }
	}
	option = {
		trigger = { is_galactic_community_member = no }
		name = f93_ralis_crisis_event.0901.b
		ai_chance = {
			factor = 150 # opposes the next option
		}
	}

	option = {
		trigger = {
			event_target:f93_ralis_planet = {
				owner = { is_same_value = event_target:f93_community_ralis_admin_country }
			}
			is_galactic_community_member = no
		}
		name = f93_ralis_crisis_event.0901.c
		f93_give_conquest_to_ralis_admin = yes
		ai_chance = {
			factor = 10
			#self serving empires should oppose it.
			modifier = {
				factor = 0.75
				is_authoritarian = yes
			}
			modifier = {
				factor = 3
				is_egalitarian = yes
			}
			modifier = {
				factor = 5
				is_xenophile = yes
			}
			modifier = {
				factor = 0.2
				is_xenophobe = yes
			}
			modifier = {
				factor = 2
				is_materialist = yes
			}
			modifier = {
				factor = 2
				is_spiritualist = yes
			}
			modifier = {
				factor = 0.5
				is_militarist = yes
			}
			modifier = {
				factor = 4
				is_pacifist = yes
			}
			modifier = {
				factor = 10
				is_galactic_custodian = yes
			}
			modifier = {
				factor = 0.5
				is_gestalt = yes
			}
			modifier = {
				factor = 3
				is_megacorp = yes
			}
			modifier = {
				factor = 0.5
				is_megacorp = yes
				is_worker_coop_empire = no
			}
			modifier = {
				factor = 0.25
				is_in_breach_of_any = yes
			}
		}
	}	
}
#The Community's Claim, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0902
	title = f93_ralis_crisis_event.0902.name
	desc = f93_ralis_crisis_event.0902.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0902 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
		every_playable_country = {
			set_country_flag = f93_com_mandate_can_happen
		}
	}
	option = {
		name = f93_ralis_crisis_event.0902.a # keep the plan
		hidden_effect = {
			event_target:f93_ralis_planet = {
				f93_create_community_ralis_admin_with_station = yes
				solar_system = { set_star_flag = f93_promised_to_ralis_admin }
			}
		}
		every_playable_country = {
			add_opinion_modifier = { modifier = f93_liberator_of_ralis who = root }
		}
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			set_global_flag = f93_community_claim_happened
		}
		
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0902.b #keep ralis
		country_event = { id = f93_ralis_crisis_event.1001}
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis
			set_global_flag = f93_community_claim_denied
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}	
		custom_tooltip = f93_ralis_crisis_event.0902.b_desc
	}

}
#The Community's Request, shown only to the liberator of ralis
country_event = {
	id = f93_ralis_crisis_event.0903
	title = f93_ralis_crisis_event.0903.name
	desc = f93_ralis_crisis_event.0903.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0903 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
		every_playable_country = {
			set_country_flag = f93_com_mandate_can_happen
		}
	}
	option = {
		name = f93_ralis_crisis_event.0903.a # keep the plan
		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
			set_global_flag = f93_community_gifted
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0903.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
			set_global_flag = f93_community_ignored
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
	}

}
#no treaty path
#The Community's Plea, shown to all but the Ralis Liberator
country_event = {
	id = f93_ralis_crisis_event.0905
	title = f93_ralis_crisis_event.0905.name
	desc = f93_ralis_crisis_event.0905.desc
	picture = GFX_evt_striking_a_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	trigger = {
		event_target:f93_ralis_planet = {
			exists = owner
			owner = { is_same_value = event_target:f93_ralis_liberator }
		}
		has_country_flag = f93_com_mandate_can_happen
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.0905 }
		country_event = { id = f93_ralis_crisis_event.1100 days = 360 }
	}
	option = {
		name = f93_ralis_crisis_event.0905.a # keep the plan

		hidden_effect = {
			set_country_flag = f93_handed_ralis_to_community
		}
		event_target:f93_ralis_planet = {
			f93_create_community_ralis_admin_with_station = yes
		}
		f93_give_conquest_to_ralis_admin = yes
	}
	
	option = {
		name = f93_ralis_crisis_event.0905.b #keep ralis
		hidden_effect = {
			set_country_flag = f93_conquered_and_kept_ralis_justly
		}
	}

}

# Paper Promises
country_event = {
	id = f93_ralis_crisis_event.1001
	title = f93_ralis_crisis_event.1001.name
	desc = f93_ralis_crisis_event.1001.desc
	picture = GFX_evt_f93_galactic_crossing_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1001 }
	}
	option = {
		name = OK
	}

}
#post war reconstruction or divided recovery
country_event = {
	id = f93_ralis_crisis_event.1100
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				event_target:f93_ralis_planet = {
					has_planet_flag = f93_galactic_community_claim
				}
			}
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1101 }
			}
		}
		else = {
			every_playable_country = {
				country_event = { id = f93_ralis_crisis_event.1102 }
			}
		}
		country_event = { id = f93_ralis_crisis_event.1103 days = 10 }
		#event 13 happens 12 years after event 12
		every_playable_country = {
			country_event = { id = f93_ralis_crisis_event.1301 days = 2160 }
		}
	}
}

# Postwar Reconstruction	
country_event = {
	id = f93_ralis_crisis_event.1101
	title = f93_ralis_crisis_event.1101.name
	desc = f93_ralis_crisis_event.1101.desc
	picture = GFX_evt_three_sided_deal
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1101 }
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
		#ralis admin collapses
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1208 days = 360 }
			}
		}
		#the last handover
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1206 days = 360 }
			}
		}
		#a could coup
		if = {
			limit = { has_global_flag = f93_community_claim_denied }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1207 days = 360 }
			}
		}
		#treaty fulfilled
		if = {
			limit = {
				OR = {
					has_global_flag = f93_community_claim_happened
					has_global_flag = f93_community_gifted
				}
			}
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1205 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = OK
	}

}

# a divided recovery
country_event = {
	id = f93_ralis_crisis_event.1102
	title = f93_ralis_crisis_event.1102.name
	desc = f93_ralis_crisis_event.1102.desc
	picture = GFX_evt_f93_galactic_crossing_refugees
	# show_sound = event_mystic_reveal
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1102 }
		#the legendary gesture
		if = {
			limit = { has_global_flag = f93_community_gifted }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1201 days = 360 }
			}
		}
		#no law, no obligation
		if = {
			limit = { has_global_flag = f93_community_ignored }
			event_target:f93_ralis_liberator = {
				country_event = { id = f93_ralis_crisis_event.1202 days = 360 }
			}
		}
		#the flag of freedom
		if = {
			limit = { has_global_flag = f93_community_gifted }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1203 days = 360 }
			}
		}
		#a new banner on ralis
		if = {
			limit = { has_global_flag = f93_community_ignored }
			every_playable_country = {
				limit = { NOT = { is_same_value = event_target:f93_ralis_liberator } }
				country_event = { id = f93_ralis_crisis_event.1204 days = 360 }
			}
		}
	}

	option = {
		name = f93_ralis_crisis_event.1102.a
		trigger = { is_galactic_community_member = yes }
	}
	option = {
		name = f93_ralis_crisis_event.1102.b
		trigger = { is_galactic_community_member = no }
	}

}

country_event = {
	id = f93_ralis_crisis_event.1103
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:f93_ralis_country = {
			every_owned_planet = {
				set_owner = event_target:f93_community_ralis_admin_country
			}
			every_system_within_border = {
				starbase = {
					set_owner = event_target:f93_community_ralis_admin_country
				}
			}
			destroy_country = yes
		}
	}
}

#The Legendary Gesture
country_event = {
	id = f93_ralis_crisis_event.1201
	title = f93_ralis_crisis_event.1201.name
	desc = f93_ralis_crisis_event.1201.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1201 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1201 }
		set_country_flag = has_seen_f93_ralis_crisis_event1201
	}
	option = {
		name = f93_ralis_crisis_event.1201.a
		
		if = {
			limit = { exists = event_target:f93_community_ralis_admin_country }
			f93_first_handover_to_ralis_admin = yes
		}
	}
}

#No Law, No Obligation
country_event = {
	id = f93_ralis_crisis_event.1202
	title = f93_ralis_crisis_event.1202.name
	desc = f93_ralis_crisis_event.1202.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1202 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1202 }
		set_country_flag = has_seen_f93_ralis_crisis_event1202
		set_global_flag = f93_community_claim_never_made # it did, but the liberator left the community to conquer ralis on their own
	}
	option = {
		name = f93_ralis_crisis_event.1202.a
		if = {
			limit = {
				exists = event_target:f93_community_ralis_admin_country
			}
			event_target:f93_community_ralis_admin_country = {
				every_system_within_border = {
					limit = { has_star_flag = f93_ralis_empire_cluster }
					starbase = {
						set_owner = event_target:f93_ralis_liberator
					}
				}
			}
		}
	}
}

#The Flag of Freedom
country_event = {
	id = f93_ralis_crisis_event.1203
	title = f93_ralis_crisis_event.1203.name
	desc = f93_ralis_crisis_event.1203.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1203 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1203 }
		set_country_flag = has_seen_f93_ralis_crisis_event1203
	}
	option = {
		name = f93_ralis_crisis_event.1203.a
	}
}

#a new banner on ralis
country_event = {
	id = f93_ralis_crisis_event.1204
	title = f93_ralis_crisis_event.1204.name
	desc = f93_ralis_crisis_event.1204.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1204 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1204 }
		set_country_flag = has_seen_f93_ralis_crisis_event1204
	}
	option = {
		name = f93_ralis_crisis_event.1204.a
	}
}


#treaty fulfilled
country_event = {
	id = f93_ralis_crisis_event.1205
	title = f93_ralis_crisis_event.1205.name
	desc = f93_ralis_crisis_event.1205.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1205 }
	}
	option = {
		name = f93_ralis_crisis_event.1205.a
		custom_tooltip = f93_ralis_crisis_event.1205.effect
		hidden_effect = {
			every_playable_country = {
				limit = { is_galactic_community_member = yes NOT = { is_same_value = event_target:f93_ralis_liberator } }
				add_opinion_modifier = {
					modifier = f93_ralis_true_liberator
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					every_system_within_border = {
						remove_claims = {
							who = prevprev
							num_of_claims = 100
						}
					}
				}
			}	
			if = {
				limit = { NOT = { has_global_flag = galactic_council_formed } }
				pass_resolution_no_cooldown = resolution_galacticreforms_form_council
			}
			if = {
				limit = { is_part_of_galactic_council = no }
				increase_council_size = yes
			}
			add_permanent_councillor = yes
			add_resource = {
				unity = 10000
			}
			add_modifier = {
				modifier = f93_ralis_true_liberator
				multiplier = 1
			}
			
			if = {
				limit = { exists = event_target:f93_community_ralis_admin_country }
				f93_final_handover_to_ralis_admin = yes
				event_target:f93_community_ralis_admin_country = {
					every_system_within_border = {
						limit = {
							# has_star_flag = f93_ralis_took_it_from_someone
							NOT = { has_star_flag = f93_ralis_empire_cluster }
						}
						save_event_target_as = f93_return_system
						event_target:f93_ralis_liberator = {
							event_target:f93_return_system = {
								if = {
									limit = { has_star_flag = f93_ralis_took_it_from@prev }
									starbase = { set_owner = prevprev }
									every_system_colony = { set_owner = prevprev }
									remove_star_flag = f93_ralis_took_it_from_someone
								}
							}
						}
					}
				}
			}
		}
	}
}

#the last handover
country_event = {
	id = f93_ralis_crisis_event.1206
	title = f93_ralis_crisis_event.1206.name
	desc = f93_ralis_crisis_event.1206.desc
	picture = GFX_evt_f93_galactic_crossing_city_world_2
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1206 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1206 }
		set_country_flag = has_seen_f93_ralis_crisis_event1206
	}
	option = {
		name = OK
	}	
}

#a Cold Coup, only seen my liberatore once
country_event = {
	id = f93_ralis_crisis_event.1207
	title = f93_ralis_crisis_event.1207.name
	desc = f93_ralis_crisis_event.1207.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_country_flag = f93_conquered_and_kept_ralis
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1207 }
	}
	option = {
		name = f93_ralis_crisis_event.1207.a
		country_event = { id = f93_ralis_crisis_event.1209 }
		if = {
			limit = {
				exists = event_target:f93_community_ralis_admin_country
			}
			event_target:f93_community_ralis_admin_country = {
				every_system_within_border = {
					limit = { has_star_flag = f93_ralis_empire_cluster }
					starbase = {
						set_owner = event_target:f93_ralis_liberator
					}
				}
			}
		}
	}
}

#Ralis Admin collapses
country_event = {
	id = f93_ralis_crisis_event.1208
	title = f93_ralis_crisis_event.1208.name
	desc = f93_ralis_crisis_event.1208.desc
	picture = GFX_evt_f93_galactic_crossing_city_world
	is_triggered_only = yes
	trigger = { NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1208 } }
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1208 }
		set_country_flag = has_seen_f93_ralis_crisis_event1208
	}
	option = {
		name = OK
		tooltip = {
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = event_target:f93_ralis_liberator }
		}
	}
}

#a quiet verdicts
country_event = {
	id = f93_ralis_crisis_event.1209
	title = f93_ralis_crisis_event.1209.name
	desc = f93_ralis_crisis_event.1209.desc
	picture = GFX_evt_alien_segregation
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1209 }
	}
	option = {
		name = f93_ralis_crisis_event.1209.a
		every_playable_country = {
			limit = { is_galactic_community_member = yes }
			add_opinion_modifier = { modifier = f93_false_liberator_of_ralis who = root }
		}
		remove_from_galactic_community = yes
		
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1300
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = f93_ralis_crisis_event1300_active
		exists = event_target:f93_community_ralis_admin_country
		is_same_value = event_target:f93_community_ralis_admin_country 
	}
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1300 days = 30 random = 30 }
		country_event = { id = f93_ralis_crisis_event.1303 days = 300 }
		random_system_within_border = {
			limit = {
				has_star_flag = f93_ralis_took_it_from_someone
				NOT = { has_star_flag = f93_ralis_empire_cluster }
			}
			save_event_target_as = f93_return_system
			random_list = {
				50 = {
					every_playable_country = {
						event_target:f93_return_system = {
							if = {
								limit = { has_star_flag = f93_ralis_took_it_from@prev }
								starbase = { set_owner = prevprev }
								every_system_colony = { set_owner = prevprev planet_event = { id = f93_ralis_crisis_event.1302 days = 1 } }
								remove_star_flag = f93_ralis_took_it_from_someone
							}
						}
					}
				}
				10 = {
					event_target:f93_return_system = {
						starbase = { set_owner = event_target:f93_ralis_liberator }
						every_system_colony = { set_owner = event_target:f93_ralis_liberator planet_event = { id = f93_ralis_crisis_event.1302 days = 1 } }
						remove_star_flag = f93_ralis_took_it_from_someone
					}
				}
				40 = {
					modifier = {
						factor = 0
						NOT = { any_system_planet = { is_colony = yes } }
					}
					create_country = {
						name = random
						type = default
						origin = origin_default
						ethos = random
						authority = random
						civics = random
						flag = random
						name_list = random
						ignore_initial_colony_error = yes
						effect = {
							add_resource = {
								minerals = 50
								energy = 150
								alloys = 10
								consumer_goods = 10
								food = 10
								trade = 450
								mult = trigger:years_passed
							}
							copy_techs_from = { target = event_target:f93_ralis_liberator }
							add_to_galactic_community = yes
						}
					}
					every_system_colony = {
						set_owner = last_created_country
						create_galcom_admin_planet = yes
					}
					starbase = { set_owner = last_created_country }
					every_neighbor_system = {
						limit = {
							has_star_flag = f93_ralis_took_it_from_someone
						}
						starbase = { set_owner = last_created_country }
						every_system_colony = { set_owner = last_created_country }
						remove_star_flag = f93_ralis_took_it_from_someone
					}
					every_country = {
						limit = { is_galactic_community_member = yes }
						establish_communications_no_message = last_created_country
					}
				}
			}
			remove_star_flag = f93_ralis_took_it_from_someone
			every_fleet_in_system = {
				limit = { owner = { is_same_value = event_target:f93_community_ralis_admin_country } }
				delete_fleet = this
			}
		}
		if = {
			limit = {
				any_system_within_border = {
					NOR = {
						has_star_flag = f93_ralis_took_it_from_someone
						has_star_flag = f93_ralis_empire_cluster
					}
				}
			}
			random_system_within_border = {
				limit = {
					NOR = {
						has_star_flag = f93_ralis_took_it_from_someone
						has_star_flag = f93_ralis_empire_cluster
					}
				}
				closest_system = {
					limit = {
						exists = space_owner
						space_owner = { is_galactic_community_member = yes }
					}
					space_owner = { save_event_target_as = f93_gets_this_system }
				}
				starbase = { set_owner = event_target:f93_gets_this_system }
			}
		}
		if = {
			limit = {
				count_system_within_border = {
					count = all
					limit = { has_star_flag = f93_ralis_empire_cluster }
				}
			}
			remove_global_flag = f93_ralis_crisis_event1300_active
		}
	}
}

#First Referendums begin
country_event = {
	id = f93_ralis_crisis_event.1301
	title = f93_ralis_crisis_event.1301.name
	desc = f93_ralis_crisis_event.1301.desc
	picture = GFX_evt_f93_galactic_crossing_senate
	is_triggered_only = yes

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1301 }
		set_global_flag = f93_ralis_crisis_event1300_active
	}
	option = {
		name = f93_ralis_crisis_event.1301.a
	}
	option = {
		name = f93_ralis_crisis_event.1301.b
	}
	after = {
		hidden_effect = {
			country_event = { id = f93_ralis_crisis_event.1401 days = 360 }
			country_event = { id = f93_ralis_crisis_event.1402 days = 360 }
			country_event = { id = f93_ralis_crisis_event.1403 days = 361 }
		}
	}
}

#community admin system joins someone else
#systems united
planet_event = {
	id = f93_ralis_crisis_event.1302
	title = f93_ralis_crisis_event.1302.name
	desc = f93_ralis_crisis_event.1302.desc
	picture = GFX_evt_happy_reunion
	is_triggered_only = yes
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1302 }
	}
	option = {
		name = f93_ralis_crisis_event.1302.a
	}
}

country_event = {
	id = f93_ralis_crisis_event.1303
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		exists = event_target:f93_community_ralis_admin_country
	}
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1304 }
	}
}

country_event = {
	id = f93_ralis_crisis_event.1304
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:f93_community_ralis_admin_country
	}
	immediate = {
		country_event = { id = f93_ralis_crisis_event.1303 days = 2 }
		country_event = { id = f93_ralis_crisis_event.1300 }
	}
}

#the zro must flow
country_event = {
	id = f93_ralis_crisis_event.1401
	title = f93_ralis_crisis_event.1401.name
	desc = f93_ralis_crisis_event.1401.desc
	picture = GFX_evt_f93_galactic_crossing_party
	is_triggered_only = yes

	trigger = {
		#combined these two means the treaty never happened and ralis was kept by liberator
		has_global_flag = f93_community_claim_never_made
		has_global_flag = f93_community_ignored
		NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1401 }
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1401 }
		set_country_flag = has_seen_f93_ralis_crisis_event1401
		set_global_flag = f93_gal_cartel_cant_happen
		country_event = { id = f93_ralis_crisis_event.1503 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.a
		allow = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } }
		event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 8 } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.b
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
		add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
	}
	option = {
		name = f93_ralis_crisis_event.1401.c
		allow = { NOT = { any_system_within_border = { is_same_value = event_target:f93_ralis_system } } }
	}
}
#The Republic of Ralis
country_event = {
	id = f93_ralis_crisis_event.1402
	title = f93_ralis_crisis_event.1402.name
	desc = f93_ralis_crisis_event.1402.desc
	picture = GFX_evt_f93_galactic_crossing_public_announcment
	is_triggered_only = yes
	trigger = {
		event_target:f93_community_ralis_admin_country = {
			any_system_within_border = { is_same_value = event_target:f93_ralis_system }
		}
		NOT = { has_country_flag = has_seen_f93_ralis_crisis_event1402 }
	}

	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1402 }
		set_country_flag = has_seen_f93_ralis_crisis_event1402
		country_event = { id = f93_ralis_crisis_event.1501 days = 960 }
		set_global_flag = f93_gal_cartel_cant_happen
		if = {
			limit = { NOT = { has_global_flag = f93_ralis_crisis_event1402_happened } }
			event_target:f93_community_ralis_admin_country = {
				set_country_type = default
				set_origin = origin_default
				change_country_flag = {
					icon = { category = "union_state" file = ralis_banner.dds }
					background = { category = "backgrounds" file = "00_solid.dds" }
					colors = {"blue" "dark_blue" "null" "null" }
				}
				clear_ethos = yes
				country_add_ethic = ethic_materialist
				country_add_ethic = ethic_egalitarian
				country_add_ethic = ethic_xenophile
				set_name = ralis_republic_NAME
				copy_techs_from = { target = event_target:f93_ralis_liberator }
				add_opinion_modifier = {
					modifier = f93_legendary_friendship
					who = event_target:f93_ralis_liberator
				}
				event_target:f93_ralis_liberator = {
					add_opinion_modifier = {
						modifier = f93_legendary_friendship
						who = event_target:f93_community_ralis_admin_country
					}
				}
			}
			event_target:f93_community_ralis_admin_country = { add_modifier = { modifier = f93_the_zro_must_flow multiplier = 10 } }
			set_global_flag = f93_ralis_crisis_event1402_happened
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.1402.a
		tooltip = {
			every_country = {
				limit = { is_galactic_community_member = yes }
				add_modifier = { modifier = f93_the_zro_must_flow multiplier = 2 }
			}
			event_target:f93_community_ralis_admin_country = {
				add_to_galactic_community = yes
			}
		}
	}
}
#A Galactic Cartel
country_event = {
	id = f93_ralis_crisis_event.1403
	title = f93_ralis_crisis_event.1403.name
	desc = f93_ralis_crisis_event.1403.desc
	picture = GFX_evt_f93_galactic_crossing_cat_walk
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_global_flag = f93_gal_cartel_cant_happen
			has_country_flag = has_seen_f93_ralis_crisis_event1403
		}
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1403 }
		set_country_flag = has_seen_f93_ralis_crisis_event1403
		set_global_flag = f93_galactic_cartel_ralis_happened
		country_event = { id = f93_ralis_crisis_event.1502 days = 960 }
	}
	option = {
		name = f93_ralis_crisis_event.1403.a
		trigger = { NOT = { any_owned_planet = { is_same_value = event_target:f93_ralis_planet } } }
		tooltip = {
			event_target:f93_ralis_planet = {
				f93_add_zro_cartel = yes
			}
		}
	}
	option = {
		name = f93_ralis_crisis_event.1403.b
		trigger = { any_owned_planet = { is_same_value = event_target:f93_ralis_planet } }
		event_target:f93_ralis_planet = {
			f93_add_zro_cartel = yes
		}
	}
}
#The Zro Syphon
country_event = {
	id = f93_ralis_crisis_event.1404
	hide_window = yes
	mean_time_to_happen = 150

	trigger = {
		any_owned_planet = {
			is_colony = yes f93_has_zro_cartel = yes
		}
	}

	immediate = {
		every_planet_within_border = {
			limit = { is_colony = no f93_has_zro_cartel = yes }
			remove_modifier = f93_zro_cartel
			remove_modifier = f93_zro_drone_cartel
		}
		random_owned_planet = {
			limit = { f93_has_zro_cartel = yes }
			solar_system = {
				closest_system = {
					use_bypasses = yes
					limit = {
						exists = owner
						exists = starbase
						starbase = {
							owner = {
								is_country_type = default
								f93_is_zro_cartel_lord = no
							}
						}
						any_system_planet = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							f93_has_zro_cartel = no
						}
						f93_add_zro_cartel = yes
					}
				}
			}
		}
		set_variable = { which = f93_zro_income value = 0 }
		export_resource_income_to_variable = {
			resource = sr_zro
			variable = f93_zro_income
		}
		divide_variable = { which = f93_zro_income value = trigger:num_owned_planets }

		every_owned_planet = {
			limit = { f93_has_zro_cartel = yes exists = owner }
			owner = {
				add_resource = {
					sr_zro = -2
					mult = f93_zro_income
				}
			}
			event_target:f93_ralis_planet = {
				owner = {
					set_variable = { which = f93_zro_income value = root.f93_zro_income }
					add_resource = {
						sr_zro = 2
						mult = f93_zro_income
					}
				}
			}
		}
	}
}

#Beyond the Lighthouse
country_event = {
	id = f93_ralis_crisis_event.1501
	title = f93_ralis_crisis_event.1501.name
	desc = f93_ralis_crisis_event.1501.desc
	picture = GFX_evt_f93_galactic_crossing_storm_world
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1501 }
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1501.a
	}
}
#Into the Shadows
country_event = {
	id = f93_ralis_crisis_event.1502
	title = f93_ralis_crisis_event.1502.name
	desc = f93_ralis_crisis_event.1502.desc
	picture = GFX_evt_shroud_tunnel
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1502 }
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1502.a
	}
	option = {
		name = f93_ralis_crisis_event.1502.b
	}
}
#The Eyes that cannot blink.
country_event = {
	id = f93_ralis_crisis_event.1503
	title = f93_ralis_crisis_event.1503.name
	desc = f93_ralis_crisis_event.1503.desc
	picture = GFX_evt_f93_galactic_crossing_dark_eyes
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		#observer_event = { id = f93_ralis_observer_event.1503 }
		country_event = { id = f93_galactic_crossing.10 }
	}
	option = {
		name = f93_ralis_crisis_event.1503.a
	}
}